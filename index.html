<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Éè„É†„Çπ„Çø„ÉºÁ•ûÁµåË°∞Âº±„Ç≤„Éº„É†</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 50%, #fecfef 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .game-header {
            text-align: center;
            margin-bottom: 30px;
            color: #fff;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .game-title {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .game-info {
            display: flex;
            gap: 30px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .info-item {
            background: rgba(255,255,255,0.9);
            padding: 10px 20px;
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            font-weight: bold;
            color: #333;
        }

        .game-board {
            display: grid;
            gap: 10px;
            justify-content: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            max-width: 100%;
            width: 100%;
        }

        .card {
            width: 100%;
            aspect-ratio: 1/1;
            cursor: pointer;
            border-radius: 15px;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
            max-width: 120px;
            justify-self: center;
        }

        .card.flipped {
            transform: rotateY(180deg);
        }

        .card.matched {
            opacity: 1;
            transform: rotateY(180deg);
            box-shadow: 0 0 20px rgba(76, 175, 80, 0.8);
            pointer-events: none;
        }

        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 15px;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .card-back {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transform: rotateY(0deg);
        }

        .card-front {
            transform: rotateY(180deg);
            background: white;
        }

        .card-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 15px;
        }

        .back-card-image {
            width: 80%;
            height: 80%;
            object-fit: contain;
        }

        .controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 20px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .btn-primary {
            background: linear-gradient(45deg, #ff6b6b, #ee5a6f);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .stage-complete {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .complete-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            color: white;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            animation: celebrateIn 0.8s ease-out;
        }

        @keyframes celebrateIn {
            0% {
                transform: scale(0.5) rotate(-10deg);
                opacity: 0;
            }
            100% {
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
        }

        .complete-title {
            font-size: 2.5rem;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .reward-image {
            width: 200px;
            height: 250px;
            object-fit: cover;
            border-radius: 15px;
            margin: 20px 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .reward-text {
            font-size: 1.5rem;
            margin: 20px 0;
        }

        .share-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        .share-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .twitter-btn {
            background: #1da1f2;
        }

        .facebook-btn {
            background: #4267b2;
        }

        .line-btn {
            background: #00c300;
        }

        .share-btn:hover {
            transform: scale(1.05);
        }

        .stage-selector {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 20px;
        }

        .stage-btn {
            padding: 10px 15px;
            border: 2px solid #fff;
            background: rgba(255,255,255,0.2);
            color: white;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .stage-btn.active {
            background: rgba(255,255,255,0.9);
            color: #333;
        }

        .stage-btn.completed {
            background: linear-gradient(45deg, #4caf50, #45a049);
            border-color: #4caf50;
        }

        @media (max-width: 768px) {
            .game-title {
                font-size: 2rem;
            }
            
            .game-info {
                gap: 15px;
            }
            
            .info-item {
                padding: 8px 15px;
                font-size: 14px;
            }

            .game-board {
                gap: 8px;
                padding: 15px;
            }

            .card {
                max-width: 90px;
            }
        }

        @media (max-width: 480px) {
            .card {
                max-width: 75px;
            }
            
            .game-board {
                gap: 6px;
                padding: 10px;
            }
        }

        .fireworks {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 999;
        }

        .firework {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #ff6b6b;
            border-radius: 50%;
            animation: firework 1s ease-out forwards;
        }

        @keyframes firework {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            100% {
                transform: scale(10);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <div class="game-header">
        <h1 class="game-title">üêπ „Éè„É†„Ç±„ÉÑÁ•ûÁµåË°∞Âº± üêπ</h1>
    </div>

    <div class="game-board" id="game-board">
        <!-- „Ç´„Éº„Éâ„ÅØJavaScript„ÅßÁîüÊàê -->
    </div>

    <div class="game-info">
        <div class="info-item">„Çπ„ÉÜ„Éº„Ç∏: <span id="current-stage">1-1</span></div>
        <div class="info-item">„Ç´„Éº„Éâ: <span id="card-count">6</span>Êûö</div>
        <div class="info-item">„Éö„Ç¢: <span id="pairs-found">0</span>/<span id="total-pairs">3</span></div>
        <div class="info-item">Ë©¶Ë°åÂõûÊï∞: <span id="attempts">0</span></div>
    </div>

    <div class="stage-selector" id="stage-selector">
        <!-- „Çπ„ÉÜ„Éº„Ç∏„Éú„Çø„É≥„ÅØJavaScript„ÅßÁîüÊàê -->
    </div>

    <div class="controls">
        <button class="btn btn-primary" onclick="shuffleCards()">„Ç∑„É£„ÉÉ„Éï„É´</button>
        <button class="btn btn-secondary" onclick="resetGame()">„É™„Çª„ÉÉ„Éà</button>
    </div>

    <div class="stage-complete" id="stage-complete">
        <div class="complete-card">
            <h2 class="complete-title">üéâ „Åä„ÇÅ„Åß„Å®„ÅÜÔºÅ üéâ</h2>
            <p class="reward-text">„Çπ„ÉÜ„Éº„Ç∏ <span id="completed-stage"></span> „Çí<span id="clear-time"></span>Áßí„Åß„ÇØ„É™„Ç¢ÔºÅ</p>
            <div id="reward-section">
                <img class="reward-image" id="reward-image" src="" alt="Â†±ÈÖ¨">
                <p class="reward-text">Â†±ÈÖ¨„Äå<span id="reward-name"></span>„Äç„ÇíÊâã„Å´ÂÖ•„Çå„ÅüÔºÅ</p>
            </div>
            <div class="share-buttons">
                <button class="share-btn twitter-btn" onclick="shareToTwitter()">Twitter„Åß„Ç∑„Çß„Ç¢</button>
                <button class="share-btn line-btn" onclick="shareToLine()">LINE„Åß„Ç∑„Çß„Ç¢</button>
            </div>
            <button class="btn btn-primary" onclick="nextStage()" style="margin-top: 20px;">Ê¨°„ÅÆ„Çπ„ÉÜ„Éº„Ç∏„Å∏</button>
        </div>
    </div>

    <div class="fireworks" id="fireworks"></div>

    <script>
        // „Éè„É†„Çπ„Çø„ÉºÁîªÂÉè„Éá„Éº„ÇøÔºàÂÆüÈöõ„ÅÆÁîªÂÉèURL„ÇíË®≠ÂÆöÔºâ
        const hamsterImages = [
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/hamster01.jpg',
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/hamster02.jpg',
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/hamster03.jpg',
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/hamster04.jpg',
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/hamster05.jpg',
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/hamster06.jpg',
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/hamster07.jpg',
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/hamster08.jpg',
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/hamster09.jpg',
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/hamster10.jpg',
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/hamster11.jpg',
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/hamster12.jpg'
        ];
        
        let cardBackImage = 'https://hamuchiranagaya.github.io/hamuketsu-cardgame/cardback.jpg';
        
        // Â†±ÈÖ¨ÁîªÂÉè„Éá„Éº„Çø
        const rewardImages = [
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/reward01.jpg',
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/reward02.jpg',
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/reward03.jpg',
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/reward04.jpg',
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/reward05.jpg',
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/reward06.jpg',
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/reward07.jpg',
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/reward08.jpg',
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/reward09.jpg',
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/reward10.jpg'
        ];

        // „Ç≤„Éº„É†Áä∂ÊÖã
        let currentStage = 1;
        let currentRound = 1;
        let flippedCards = [];
        let matchedPairs = 0;
        let attempts = 0;
        let isChecking = false;
        let completedStages = new Set();
        let startTime = 0;
        let gameTime = 0;

        // „Çπ„ÉÜ„Éº„Ç∏Ë®≠ÂÆöÔºà6Êûö„Åã„Çâ24Êûö„Åæ„Åß„ÄÅ2Êûö„Åö„Å§Â¢óÂä†Ôºâ
        const stageConfig = {
            1: { cards: 6, pairs: 3, rounds: 3 },
            2: { cards: 8, pairs: 4, rounds: 3 },
            3: { cards: 10, pairs: 5, rounds: 3 },
            4: { cards: 12, pairs: 6, rounds: 3 },
            5: { cards: 14, pairs: 7, rounds: 3 },
            6: { cards: 16, pairs: 8, rounds: 3 },
            7: { cards: 18, pairs: 9, rounds: 3 },
            8: { cards: 20, pairs: 10, rounds: 3 },
            9: { cards: 22, pairs: 11, rounds: 3 },
            10: { cards: 24, pairs: 12, rounds: 3 }
        };

        // ÁîªÂÉè„ÇíË™≠„ÅøËæº„ÇÄÈñ¢Êï∞
        async function loadImages() {
            console.log('Loading images...');
            
            // window.fs „ÅåÂà©Áî®ÂèØËÉΩ„Åã„ÉÅ„Çß„ÉÉ„ÇØ
            if (typeof window.fs !== 'undefined' && window.fs.readFile) {
                try {
                    // ÂÆüÈöõ„ÅÆ„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Åï„Çå„ÅüÁîªÂÉè„ÇíË™≠„ÅøËæº„Åø
                    const imageNames = [
                        '„Åì„Åì„Åü', '„Åì„Å≤„Çì', '„Åì„Åµ„Çå', '„Ç≥„É¨„ÉÉ„Éà', '„Ç¢„Éï„Ç©„Ç¨„Éº„Éà', 
                        '„Ç¢„Éû„É¨„ÉÉ„ÉÜ„Ç£', '„Åà„Åè„Çå„ÅÇ', '„Åä„ÅØ„Åé', '„Åã„Åö„Å¶„Çâ', '„Ç¨„Éä„ÉÉ„Ç∑„É•',
                        '„Ç´„Éï„Çß„Ç™„É¨', '„Çµ„É´„Çø„Éä', '„Åì„Åì„ÅÇ'
                    ];
                    
                    // „Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Åï„Çå„ÅüÁîªÂÉè„Éï„Ç°„Ç§„É´„ÇíË©¶Ë°å
                    for (let i = 1; i <= 20; i++) {
                        if (i === 9) continue; // Image 9 „ÅØË£èÈù¢„Å™„ÅÆ„Åß„Çπ„Ç≠„ÉÉ„Éó
                        
                        try {
                            console.log(`Attempting to load Image ${i}`);
                            const imageData = await window.fs.readFile(`Image ${i}: `);
                            const blob = new Blob([imageData]);
                            const imageUrl = URL.createObjectURL(blob);
                            hamsterImages.push(imageUrl);
                            console.log(`Successfully loaded Image ${i}`);
                        } catch (error) {
                            console.log(`Image ${i} not found: ${error.message}`);
                        }
                    }
                    
                    // „Ç´„Éº„ÉâË£èÈù¢ÔºàImage 9Ôºâ
                    try {
                        console.log('Loading card back image (Image 9)...');
                        const backData = await window.fs.readFile('Image 9: ');
                        const backBlob = new Blob([backData]);
                        cardBackImage = URL.createObjectURL(backBlob);
                        console.log('Card back image loaded successfully');
                    } catch (error) {
                        console.log('Card back image not found: ' + error.message);
                    }
                    
                } catch (error) {
                    console.error('Error in file system access:', error);
                }
            } else {
                console.log('File system access not available');
            }
            
            // ÁîªÂÉè„ÅåË™≠„ÅøËæº„ÇÅ„Å™„ÅÑÂ†¥Âêà„ÅØ„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ„Çí‰ΩøÁî®
            if (hamsterImages.length === 0) {
                console.log('No images loaded, using fallback');
                setImageData();
            }
            
            console.log(`Total images available: ${hamsterImages.length}`);
            initializeGame();
        }

        // „Ç≤„Éº„É†ÂàùÊúüÂåñ
        function initializeGame() {
            createStageSelector();
            startStage(currentStage, currentRound);
        }

        // „Çπ„ÉÜ„Éº„Ç∏„Çª„É¨„ÇØ„Çø„Éº‰ΩúÊàê
        function createStageSelector() {
            const selector = document.getElementById('stage-selector');
            selector.innerHTML = '';
            
            for (let stage = 1; stage <= 10; stage++) {
                for (let round = 1; round <= 3; round++) {
                    const btn = document.createElement('button');
                    btn.className = 'stage-btn';
                    btn.textContent = `${stage}-${round}`;
                    btn.onclick = () => startStage(stage, round);
                    
                    if (completedStages.has(`${stage}-${round}`)) {
                        btn.classList.add('completed');
                    }
                    if (stage === currentStage && round === currentRound) {
                        btn.classList.add('active');
                    }
                    
                    selector.appendChild(btn);
                }
            }
        }

        // „Çπ„ÉÜ„Éº„Ç∏ÈñãÂßã
        function startStage(stage, round) {
            currentStage = stage;
            currentRound = round;
            matchedPairs = 0;
            attempts = 0;
            flippedCards = [];
            isChecking = false;
            startTime = Date.now();
            gameTime = 0;

            updateUI();
            createGameBoard();
            createStageSelector();
        }

        // „Ç≤„Éº„É†„Éú„Éº„Éâ‰ΩúÊàê
        function createGameBoard() {
            const board = document.getElementById('game-board');
            board.innerHTML = '';
            
            const config = stageConfig[currentStage];
            const cardCount = config.cards;
            const pairCount = config.pairs;
            
            // „É¨„Çπ„Éù„É≥„Ç∑„Éñ„Ç∞„É™„ÉÉ„Éâ„É¨„Ç§„Ç¢„Ç¶„ÉàË®≠ÂÆö
            if (cardCount <= 8) {
                board.style.gridTemplateColumns = `repeat(${cardCount/2}, 1fr)`;
                board.style.maxWidth = `${cardCount/2 * 130}px`;
            } else if (cardCount <= 12) {
                board.style.gridTemplateColumns = 'repeat(6, 1fr)';
                board.style.maxWidth = '780px';
            } else if (cardCount <= 16) {
                board.style.gridTemplateColumns = 'repeat(8, 1fr)';
                board.style.maxWidth = '1040px';
            } else if (cardCount <= 20) {
                board.style.gridTemplateColumns = 'repeat(10, 1fr)';
                board.style.maxWidth = '1300px';
            } else {
                board.style.gridTemplateColumns = 'repeat(12, 1fr)';
                board.style.maxWidth = '1560px';
            }

            // „É¢„Éê„Ç§„É´ÂØæÂøú: ÁîªÈù¢ÂπÖ„ÅåÁã≠„ÅÑÂ†¥Âêà„ÅØÂàóÊï∞„ÇíË™øÊï¥
            const screenWidth = window.innerWidth;
            if (screenWidth <= 480) {
                if (cardCount <= 6) {
                    board.style.gridTemplateColumns = 'repeat(3, 1fr)';
                } else if (cardCount <= 12) {
                    board.style.gridTemplateColumns = 'repeat(4, 1fr)';
                } else if (cardCount <= 20) {
                    board.style.gridTemplateColumns = 'repeat(5, 1fr)';
                } else {
                    board.style.gridTemplateColumns = 'repeat(6, 1fr)';
                }
                board.style.maxWidth = '360px';
            } else if (screenWidth <= 768) {
                if (cardCount <= 8) {
                    board.style.gridTemplateColumns = 'repeat(4, 1fr)';
                } else if (cardCount <= 16) {
                    board.style.gridTemplateColumns = 'repeat(6, 1fr)';
                } else {
                    board.style.gridTemplateColumns = 'repeat(8, 1fr)';
                }
                board.style.maxWidth = '600px';
            }

            // „Ç´„Éº„Éâ„Éö„Ç¢„Çí‰ΩúÊàê
            const cardPairs = [];
            for (let i = 0; i < pairCount; i++) {
                const imageIndex = i % hamsterImages.length;
                cardPairs.push(imageIndex, imageIndex);
            }

            // „Ç∑„É£„ÉÉ„Éï„É´
            shuffleArray(cardPairs);

            // „Ç´„Éº„ÉâË¶ÅÁ¥†„Çí‰ΩúÊàê
            cardPairs.forEach((imageIndex, index) => {
                const card = createCard(imageIndex, index);
                board.appendChild(card);
            });
        }

        // „Ç´„Éº„ÉâË¶ÅÁ¥†‰ΩúÊàê
        function createCard(imageIndex, cardIndex) {
            const card = document.createElement('div');
            card.className = 'card';
            card.dataset.imageIndex = imageIndex;
            card.dataset.cardIndex = cardIndex;
            card.onclick = () => flipCard(card);

            const cardBack = document.createElement('div');
            cardBack.className = 'card-face card-back';
            
            const cardFront = document.createElement('div');
            cardFront.className = 'card-face card-front';

            // Ë£èÈù¢ÁîªÂÉè
            if (cardBackImage) {
                const backImg = document.createElement('img');
                backImg.src = cardBackImage;
                backImg.className = 'back-card-image';
                cardBack.appendChild(backImg);
            } else {
                cardBack.textContent = '?';
                cardBack.style.fontSize = '3rem';
                cardBack.style.color = 'white';
            }

            // Ë°®Èù¢ÁîªÂÉè
            if (hamsterImages[imageIndex]) {
                const frontImg = document.createElement('img');
                frontImg.src = hamsterImages[imageIndex];
                frontImg.className = 'card-image';
                cardFront.appendChild(frontImg);
            } else {
                cardFront.style.background = `hsl(${imageIndex * 30}, 70%, 60%)`;
                cardFront.textContent = 'üêπ';
                cardFront.style.fontSize = '3rem';
            }

            card.appendChild(cardBack);
            card.appendChild(cardFront);

            return card;
        }

        // „Ç´„Éº„Éâ„Éï„É™„ÉÉ„Éó
        function flipCard(card) {
            if (isChecking || card.classList.contains('flipped') || card.classList.contains('matched')) {
                return;
            }

            card.classList.add('flipped');
            flippedCards.push(card);

            if (flippedCards.length === 2) {
                attempts++;
                updateUI();
                checkMatch();
            }
        }

        // „Éû„ÉÉ„ÉÅÁ¢∫Ë™ç
        function checkMatch() {
            isChecking = true;
            const [card1, card2] = flippedCards;
            
            setTimeout(() => {
                if (card1.dataset.imageIndex === card2.dataset.imageIndex) {
                    // „Éû„ÉÉ„ÉÅÊàêÂäü
                    card1.classList.add('matched');
                    card2.classList.add('matched');
                    matchedPairs++;
                    
                    if (matchedPairs === stageConfig[currentStage].pairs) {
                        setTimeout(() => completeStage(), 500);
                    }
                } else {
                    // „Éû„ÉÉ„ÉÅÂ§±Êïó
                    card1.classList.remove('flipped');
                    card2.classList.remove('flipped');
                }
                
                flippedCards = [];
                isChecking = false;
                updateUI();
            }, 1000);
        }

        // „Çπ„ÉÜ„Éº„Ç∏„ÇØ„É™„Ç¢
        function completeStage() {
            const stageKey = `${currentStage}-${currentRound}`;
            completedStages.add(stageKey);
            gameTime = Math.floor((Date.now() - startTime) / 1000);
            
            // Ëä±ÁÅ´„Ç®„Éï„Çß„ÇØ„Éà
            createFireworks();
            
            // Â†±ÈÖ¨„ÅØÊúÄÁµÇ„É©„Ç¶„É≥„ÉâÔºàx-3Ôºâ„ÅÆ„ÅøË°®Á§∫
            const showReward = currentRound === 3;
            let rewardImage = '';
            let rewardName = '';
            
            if (showReward && rewardImages.length > 0) {
                // Â†±ÈÖ¨ÁîªÂÉè„Çí‰ΩøÁî®Ôºà„Çπ„ÉÜ„Éº„Ç∏„Å´ÂØæÂøúÔºâ
                const rewardIndex = (currentStage - 1) % rewardImages.length;
                rewardImage = rewardImages[rewardIndex];
                rewardName = getRewardName(currentStage);
            }
            
            // „ÇØ„É™„Ç¢ÁîªÈù¢Ë°®Á§∫
            document.getElementById('completed-stage').textContent = stageKey;
            document.getElementById('clear-time').textContent = gameTime;
            
            if (showReward) {
                document.getElementById('reward-section').style.display = 'block';
                document.getElementById('reward-image').src = rewardImage;
                document.getElementById('reward-name').textContent = rewardName;
            } else {
                document.getElementById('reward-section').style.display = 'none';
            }
            
            document.getElementById('stage-complete').style.display = 'flex';
        }

        // Â†±ÈÖ¨ÂêçÂèñÂæó
        function getRewardName(stage) {
            const rewards = [
                '„Å≤„Åæ„Çè„Çä„ÅÆÁ®Æ', '„Å´„Çì„Åò„Çì„Çπ„ÉÜ„Ç£„ÉÉ„ÇØ', '„Éè„É†„Ç∑„Éº„Éâ', 
                '„Éó„É¨„Éü„Ç¢„É†„Éö„É¨„ÉÉ„Éà', 'ÁâπË£Ω„Åä„ÇÑ„Å§', '„Ç¥„Éº„É´„Éá„É≥„Éä„ÉÉ„ÉÑ',
                '„É¨„Ç∏„Çß„É≥„Éâ„Ç≠„É£„É≠„ÉÉ„Éà', '„ÉÄ„Ç§„É§„É¢„É≥„Éâ„Ç∑„Éº„Éâ', '„É¨„Ç¢Âõû„ÅóËªä', '„Éü„É©„ÇØ„É´„ÉÅ„Éº„Ç∫'
            ];
            return rewards[stage - 1] || '„Éü„Çπ„ÉÜ„É™„ÉºÂ†±ÈÖ¨';
        }

        // Ëä±ÁÅ´„Ç®„Éï„Çß„ÇØ„Éà
        function createFireworks() {
            const fireworks = document.getElementById('fireworks');
            
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const firework = document.createElement('div');
                    firework.className = 'firework';
                    firework.style.left = Math.random() * 100 + '%';
                    firework.style.top = Math.random() * 100 + '%';
                    firework.style.background = `hsl(${Math.random() * 360}, 70%, 60%)`;
                    fireworks.appendChild(firework);
                    
                    setTimeout(() => firework.remove(), 1000);
                }, i * 100);
            }
        }

        // Ê¨°„ÅÆ„Çπ„ÉÜ„Éº„Ç∏„Å∏
        function nextStage() {
            document.getElementById('stage-complete').style.display = 'none';
            
            if (currentRound < 3) {
                startStage(currentStage, currentRound + 1);
            } else if (currentStage < 10) {
                startStage(currentStage + 1, 1);
            } else {
                // ÂÖ®„Çπ„ÉÜ„Éº„Ç∏„ÇØ„É™„Ç¢
                alert('üéâ ÂÖ®„Çπ„ÉÜ„Éº„Ç∏„ÇØ„É™„Ç¢ÔºÅ„Åä„ÇÅ„Åß„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„ÅôÔºÅ üéâ');
            }
        }

        // SNS„Ç∑„Çß„Ç¢Ê©üËÉΩ
        function shareToTwitter() {
            const showReward = currentRound === 3;
            let text;
            
            if (showReward) {
                const rewardName = getRewardName(currentStage);
                text = `${currentStage}„Çπ„ÉÜ„Éº„Ç∏ ${gameTime}Áßí„Åß„ÇØ„É™„Ç¢‚ú®Â†±ÈÖ¨${rewardName}„Çí„Ç≤„ÉÉ„Éàüêπ #„Éè„É†„Ç±„ÉÑÁ•ûÁµåË°∞Âº± #„Éè„É†„Çπ„Çø„Éº #„ÅØ„ÇÄ„ÉÅ„É©`;
            } else {
                text = `${currentStage}-${currentRound} ${gameTime}Áßí„Åß„ÇØ„É™„Ç¢‚ú® #„Éè„É†„Ç±„ÉÑÁ•ûÁµåË°∞Âº± #„Éè„É†„Çπ„Çø„Éº #„ÅØ„ÇÄ„ÉÅ„É©`;
            }
            
            const url = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}`;
            window.open(url, '_blank');
        }

        function shareToLine() {
            const showReward = currentRound === 3;
            let text;
            
            if (showReward) {
                const rewardName = getRewardName(currentStage);
                text = `${currentStage}„Çπ„ÉÜ„Éº„Ç∏ ${gameTime}Áßí„Åß„ÇØ„É™„Ç¢‚ú®Â†±ÈÖ¨${rewardName}„Çí„Ç≤„ÉÉ„Éàüêπ`;
            } else {
                text = `${currentStage}-${currentRound} ${gameTime}Áßí„Åß„ÇØ„É™„Ç¢‚ú®`;
            }
            
            const url = `https://social-plugins.line.me/lineit/share?url=${encodeURIComponent(window.location.href)}&text=${encodeURIComponent(text)}`;
            window.open(url, '_blank');
        }

        // „É¶„Éº„ÉÜ„Ç£„É™„ÉÜ„Ç£Èñ¢Êï∞
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function shuffleCards() {
            createGameBoard();
        }

        function resetGame() {
            startStage(1, 1);
            completedStages.clear();
        }

        function updateUI() {
            document.getElementById('current-stage').textContent = `${currentStage}-${currentRound}`;
            document.getElementById('card-count').textContent = stageConfig[currentStage].cards;
            document.getElementById('pairs-found').textContent = matchedPairs;
            document.getElementById('total-pairs').textContent = stageConfig[currentStage].pairs;
            document.getElementById('attempts').textContent = attempts;
        }

        // ÂÆüÈöõ„ÅÆÁîªÂÉè„Éá„Éº„Çø„ÇíË®≠ÂÆö„Åô„ÇãÈñ¢Êï∞Ôºà„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÁî®Ôºâ
        function setImageData() {
            console.log('Using fallback hamster images');
            // „Éè„É†„Çπ„Çø„ÉºÁµµÊñáÂ≠ó„Çí‰Ωø„Å£„ÅüÂ§öÊßò„Å™„Éó„É¨„Éº„Çπ„Éõ„É´„ÉÄ„Éº
            const hamsterEmojis = ['üêπ', 'üê≠', 'üê∞', 'ü¶î', 'üêøÔ∏è'];
            const colors = ['#FFB6C1', '#98FB98', '#87CEEB', '#DDA0DD', '#F0E68C', '#FFA07A', '#20B2AA', '#87CEFA', '#F5DEB3'];
            
            for (let i = 0; i < 19; i++) {
                const emoji = hamsterEmojis[i % hamsterEmojis.length];
                const color = colors[i % colors.length];
                hamsterImages.push(`data:image/svg+xml,${encodeURIComponent(`
                    <svg width="200" height="250" xmlns="http://www.w3.org/2000/svg">
                        <rect width="200" height="250" fill="${color}" rx="15"/>
                        <text x="100" y="100" text-anchor="middle" font-size="60">${emoji}</text>
                        <text x="100" y="140" text-anchor="middle" font-size="16" fill="#333">„Éè„É†„Çπ„Çø„Éº</text>
                        <text x="100" y="160" text-anchor="middle" font-size="16" fill="#333">${i + 1}</text>
                    </svg>
                `)}`);
            }
            
            // „Ç´„Éº„ÉâË£èÈù¢
            if (!cardBackImage) {
                cardBackImage = `data:image/svg+xml,${encodeURIComponent(`
                    <svg width="200" height="250" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <linearGradient id="backGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#667eea;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#764ba2;stop-opacity:1" />
                            </linearGradient>
                        </defs>
                        <rect width="200" height="250" fill="url(#backGrad)" rx="15"/>
                        <text x="100" y="125" text-anchor="middle" font-size="80" fill="white">?</text>
                        <circle cx="50" cy="50" r="10" fill="rgba(255,255,255,0.3)"/>
                        <circle cx="150" cy="80" r="8" fill="rgba(255,255,255,0.2)"/>
                        <circle cx="170" cy="200" r="12" fill="rgba(255,255,255,0.2)"/>
                        <circle cx="30" cy="180" r="6" fill="rgba(255,255,255,0.3)"/>
                    </svg>
                `)}`;
            }
            
            console.log(`Generated ${hamsterImages.length} fallback images`);
        }

        // „Éö„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÊôÇ„ÅÆÂàùÊúüÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            // ÂÆüÈöõ„ÅÆÁîªÂÉè„ÇíË™≠„ÅøËæº„ÇÄ
            loadImages();
        });
    </script>
</body>
</html>