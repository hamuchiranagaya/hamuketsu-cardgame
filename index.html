<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã¯ã‚€ã‚±ãƒ„ç¥çµŒè¡°å¼±</title>
    
    <!-- PWAè¨­å®š -->
    <link rel="manifest" href="data:application/json,{%22name%22:%22ã¯ã‚€ã‚±ãƒ„ç¥çµŒè¡°å¼±%22,%22short_name%22:%22ã¯ã‚€ã‚±ãƒ„%22,%22icons%22:[{%22src%22:%22https://hamuchiranagaya.github.io/hamuketsu-cardgame/hamuketsu_icon_512.png%22,%22sizes%22:%22512x512%22,%22type%22:%22image/png%22}],%22start_url%22:%22./%22,%22display%22:%22standalone%22,%22theme_color%22:%22%23ff6b9d%22,%22background_color%22:%22%23fff%22}">
    <link rel="icon" href="https://hamuchiranagaya.github.io/hamuketsu-cardgame/hamuketsu_icon_512.png">
    <link rel="apple-touch-icon" href="https://hamuchiranagaya.github.io/hamuketsu-cardgame/hamuketsu_icon_512.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 50%, #fecfef 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .game-header {
            text-align: center;
            margin-bottom: 20px;
            color: #fff;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .game-title {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .creator-link {
            margin-bottom: 15px;
        }

        .creator-link a {
            color: #fff;
            text-decoration: none;
            font-size: 14px;
            opacity: 0.9;
            transition: opacity 0.3s ease;
        }

        .creator-link a:hover {
            opacity: 1;
            text-decoration: underline;
        }

        .stamina-info {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .stamina-item {
            background: rgba(255,255,255,0.9);
            padding: 8px 16px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            font-weight: bold;
            color: #333;
            font-size: 14px;
        }

        .game-board {
            display: grid;
            gap: 10px;
            justify-content: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            max-width: 100%;
            width: 100%;
            max-width: 400px;
        }

        .card {
            width: 100%;
            aspect-ratio: 1/1;
            cursor: pointer;
            border-radius: 15px;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
            min-width: 90px;
            max-width: 140px;
            justify-self: center;
        }

        .card.flipped {
            transform: rotateY(180deg);
        }

        .card.matched {
            opacity: 1;
            transform: rotateY(180deg);
            box-shadow: 0 0 20px rgba(76, 175, 80, 0.8);
            pointer-events: none;
        }

        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 15px;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .card-back {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transform: rotateY(0deg);
        }

        .card-front {
            transform: rotateY(180deg);
            background: white;
        }

        .card-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 15px;
        }

        .back-card-image {
            width: 80%;
            height: 80%;
            object-fit: contain;
        }

        .game-start-btn {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            margin: 20px 0;
        }

        .game-start-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .game-start-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .attempts-counter {
            text-align: center;
            margin: 20px 0;
        }

        .attempts-display {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 18px;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            display: inline-block;
        }

        .attempts-warning {
            background: linear-gradient(45deg, #ff6b6b, #ee5a6f) !important;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .game-info {
            display: flex;
            gap: 30px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .info-item {
            background: rgba(255,255,255,0.9);
            padding: 10px 20px;
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            font-weight: bold;
            color: #333;
        }

        .stage-selector {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 20px;
        }

        .stage-btn {
            padding: 10px 15px;
            border: 2px solid #fff;
            background: rgba(255,255,255,0.2);
            color: white;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .stage-btn.active {
            background: rgba(255,255,255,0.9);
            color: #333;
        }

        .stage-btn.completed {
            background: linear-gradient(45deg, #4caf50, #45a049);
            border-color: #4caf50;
        }

        .stage-btn.locked {
            background: rgba(128,128,128,0.5);
            color: #666;
            cursor: not-allowed;
            border-color: #999;
        }

        .controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 20px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .btn-primary {
            background: linear-gradient(45deg, #ff6b6b, #ee5a6f);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 90vw;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }

        .reward-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .reward-item {
            text-align: center;
            padding: 15px;
            border-radius: 15px;
            background: #f5f5f5;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .reward-item:hover {
            transform: scale(1.05);
        }

        .reward-item img {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .reward-name {
            font-size: 12px;
            margin-bottom: 5px;
        }

        .reward-count {
            font-weight: bold;
            color: #333;
        }

        /* ã‚²ãƒ¼ãƒ é–‹å§‹ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .game-start-section {
            text-align: center;
            background: rgba(255,255,255,0.1);
            padding: 30px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            max-width: 350px;
            width: 100%;
        }

        .game-icon {
            width: 120px;
            height: 120px;
            margin: 0 auto 30px;
            border-radius: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            transition: transform 0.3s ease;
        }

        .game-icon:hover {
            transform: scale(1.05);
        }

        /* ãƒ›ãƒ¼ãƒ ç”»é¢è¿½åŠ ãƒœã‚¿ãƒ³ */
        .install-section {
            margin-bottom: 20px;
        }

        .install-btn {
            background: linear-gradient(45deg, #9c27b0, #673ab7);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            margin-bottom: 10px;
        }

        .install-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .install-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        @media (max-width: 768px) {
            .game-title {
                font-size: 2rem;
            }
            
            .creator-link a {
                font-size: 12px;
            }
            
            .card {
                min-width: 80px;
                max-width: 120px;
            }

            .game-icon {
                width: 100px;
                height: 100px;
            }

            .game-start-section {
                padding: 25px;
                max-width: 320px;
            }

            .game-board {
                max-width: 350px;
                padding: 15px;
            }
        }

        .stage-complete {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .complete-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            color: white;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            animation: celebrateIn 0.8s ease-out;
        }

        @keyframes celebrateIn {
            0% {
                transform: scale(0.5) rotate(-10deg);
                opacity: 0;
            }
            100% {
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
        }

        .complete-title {
            font-size: 2.5rem;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .reward-image {
            width: 200px;
            height: 200px;
            object-fit: cover;
            border-radius: 15px;
            margin: 20px 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .reward-text {
            font-size: 1.5rem;
            margin: 20px 0;
        }

        .share-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        .share-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .x-btn {
            background: #000000;
        }

        .line-btn {
            background: #00c300;
        }

        .share-btn:hover {
            transform: scale(1.05);
        }

        .fireworks {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 999;
        }

        .firework {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #ff6b6b;
            border-radius: 50%;
            animation: firework 1s ease-out forwards;
        }

        @keyframes firework {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            100% {
                transform: scale(10);
                opacity: 0;
            }
        }

        .game-over {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1001;
        }

        .game-over-card {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            color: white;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            animation: slideIn 0.8s ease-out;
        }

        @keyframes slideIn {
            0% {
                transform: translateY(-50px);
                opacity: 0;
            }
            100% {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @media (max-width: 480px) {
            .card {
                min-width: 70px;
                max-width: 100px;
            }

            .game-start-section {
                padding: 20px;
                max-width: 300px;
            }

            .game-board {
                max-width: 320px;
                padding: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="game-header">
        <h1 class="game-title">ğŸ¹ ã¯ã‚€ã‚±ãƒ„ç¥çµŒè¡°å¼± ğŸ¹</h1>
        <div class="creator-link">
            <a href="https://www.youtube.com/@hamuchira" target="_blank">by ã‚‚ã£ã¨ï¼ã¯ã‚€ãƒãƒ©é•·å±‹ch.</a>
        </div>
        <div class="stamina-info">
            <div class="stamina-item">ğŸŒ» ã²ã¾ç¨®: <span id="sunflower-count">6/6</span></div>
            <div class="stamina-item" id="stamina-timer" style="display: none;">å›å¾©ã¾ã§: <span id="recovery-time"></span></div>
        </div>
    </div>

    <div class="game-start-section" id="game-start-section" style="text-align: center;">
        <img src="https://hamuchiranagaya.github.io/hamuketsu-cardgame/hamuketsu_icon_512.png" alt="ãƒãƒ ã‚±ãƒ„ã‚¢ã‚¤ã‚³ãƒ³" class="game-icon">
        
        <div class="install-section">
            <button class="install-btn" id="install-btn" style="display: none;">ğŸ“± ãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ </button>
        </div>
        
        <button class="game-start-btn" id="game-start-btn">ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆï¼</button>
    </div>

    <div class="game-board" id="game-board" style="display: none;">
        <!-- ã‚«ãƒ¼ãƒ‰ã¯JavaScriptã§ç”Ÿæˆ -->
    </div>

    <div class="attempts-counter" id="attempts-counter" style="display: none;">
        <div class="attempts-display">æ®‹ã‚Šè©¦è¡Œå›æ•°: <span id="remaining-attempts">5</span>å›</div>
    </div>

    <div class="game-info">
        <div class="info-item">ã‚¹ãƒ†ãƒ¼ã‚¸: <span id="current-stage">1-1</span></div>
        <div class="info-item">ã‚«ãƒ¼ãƒ‰: <span id="card-count">6</span>æš</div>
        <div class="info-item">ãƒšã‚¢: <span id="pairs-found">0</span>/<span id="total-pairs">3</span></div>
        <div class="info-item">è©¦è¡Œå›æ•°: <span id="attempts">0</span></div>
    </div>

    <div class="stage-selector" id="stage-selector">
        <!-- ã‚¹ãƒ†ãƒ¼ã‚¸ãƒœã‚¿ãƒ³ã¯JavaScriptã§ç”Ÿæˆ -->
    </div>

    <div class="controls">
        <button class="btn btn-secondary" id="reward-list-btn">ã‚¯ãƒªã‚¢å ±é…¬ä¸€è¦§</button>
        <button class="btn btn-secondary" id="collection-btn">å ±é…¬å›³é‘‘</button>
    </div>

    <!-- ã‚¯ãƒªã‚¢å ±é…¬ä¸€è¦§ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="modal" id="reward-list-modal">
        <div class="modal-content">
            <h2>ğŸ ã‚¯ãƒªã‚¢å ±é…¬ä¸€è¦§</h2>
            <div class="reward-grid" id="reward-list-grid"></div>
            <button class="btn btn-primary" style="margin-top: 20px; width: 100%;" id="close-reward-list">é–‰ã˜ã‚‹</button>
        </div>
    </div>

    <!-- å ±é…¬å›³é‘‘ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="modal" id="collection-modal">
        <div class="modal-content">
            <h2>ğŸ“š å ±é…¬å›³é‘‘</h2>
            <div class="reward-grid" id="collection-grid"></div>
            <button class="btn btn-primary" style="margin-top: 20px; width: 100%;" id="close-collection">é–‰ã˜ã‚‹</button>
        </div>
    </div>

    <!-- å ±é…¬è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="modal" id="reward-detail-modal">
        <div class="modal-content" style="max-width: 400px; text-align: center;">
            <h3 id="reward-detail-name" style="margin-bottom: 20px;"></h3>
            <img id="reward-detail-image" src="" alt="å ±é…¬è©³ç´°" style="width: 250px; height: 250px; object-fit: cover; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
            <p id="reward-detail-count" style="margin: 20px 0; font-size: 18px; font-weight: bold;"></p>
            <button class="btn btn-primary" id="close-reward-detail">é–‰ã˜ã‚‹</button>
        </div>
    </div>

    <!-- ã‚¹ãƒ†ãƒ¼ã‚¸ã‚¯ãƒªã‚¢æ¼”å‡º -->
    <div class="stage-complete" id="stage-complete">
        <div class="complete-card">
            <h2 class="complete-title">ğŸ‰ ãŠã‚ã§ã¨ã†ï¼ ğŸ‰</h2>
            <p class="reward-text">ã‚¹ãƒ†ãƒ¼ã‚¸ <span id="completed-stage"></span> ã‚’<span id="clear-time"></span>ç§’ã§ã‚¯ãƒªã‚¢ï¼</p>
            <div id="reward-section">
                <img class="reward-image" id="reward-image" src="" alt="å ±é…¬">
                <p class="reward-text">å ±é…¬ã€Œ<span id="reward-name"></span>ã€ã‚’æ‰‹ã«å…¥ã‚ŒãŸï¼</p>
            </div>
            <div class="share-buttons">
                <button class="share-btn x-btn" id="share-twitter">Xã§ã‚·ã‚§ã‚¢</button>
                <button class="share-btn line-btn" id="share-line">LINEã§ã‚·ã‚§ã‚¢</button>
            </div>
            <button class="btn btn-primary" id="next-stage-btn" style="margin-top: 20px;">æ¬¡ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã¸</button>
        </div>
    </div>

    <!-- ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ç”»é¢ -->
    <div class="game-over" id="game-over">
        <div class="game-over-card">
            <h2>ğŸ˜µ è©¦è¡Œå›æ•°ã‚ªãƒ¼ãƒãƒ¼ï¼ ğŸ˜µ</h2>
            <p>åˆ¶é™å›æ•°å†…ã«ã‚¯ãƒªã‚¢ã§ãã¾ã›ã‚“ã§ã—ãŸ</p>
            <div style="margin: 20px 0;">
                <p>ğŸŒ» ã²ã¾ç¨®ã‚’1å€‹ä½¿ã£ã¦è©¦è¡Œå›æ•°ã‚’5å›è¿½åŠ ã—ã¾ã™ã‹ï¼Ÿ</p>
                <p>æ®‹ã‚Š: <span id="remaining-seeds"></span>å€‹</p>
            </div>
            <div style="display: flex; gap: 15px; justify-content: center; margin-top: 20px;">
                <button class="btn btn-primary" id="retry-btn">ã²ã¾ç¨®ã§+5å›</button>
                <button class="btn btn-secondary" id="give-up-btn">è«¦ã‚ã‚‹</button>
            </div>
        </div>
    </div>

    <!-- è«¦ã‚ã‚‹ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="modal" id="give-up-confirm-modal" style="z-index: 2000;">
        <div class="modal-content" style="max-width: 400px; text-align: center; background: white; position: relative; z-index: 2001;">
            <h3 style="margin-bottom: 20px; color: #ff6b6b;">âš ï¸ ç¢ºèª</h3>
            <p style="margin-bottom: 20px; line-height: 1.5; color: #333;">
                æœ¬å½“ã«è«¦ã‚ã¾ã™ã‹ï¼Ÿ<br><br>
                <strong>æ³¨æ„:</strong> è«¦ã‚ã‚‹ã¨æœ€åˆã®ã‚¹ãƒ†ãƒ¼ã‚¸(1-1)ã«æˆ»ã‚Šã¾ã™ã€‚<br>
                ç¾åœ¨ã®é€²æ—ã¯ä¿æŒã•ã‚Œã¾ã™ãŒã€ã“ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã¯ã‚„ã‚Šç›´ã—ã«ãªã‚Šã¾ã™ã€‚
            </p>
            <div style="display: flex; gap: 15px; justify-content: center;">
                <button class="btn btn-secondary" id="give-up-cancel">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                <button class="btn btn-primary" id="give-up-confirm">è«¦ã‚ã‚‹</button>
            </div>
        </div>
    </div>

    <!-- èŠ±ç«ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ -->
    <div class="fireworks" id="fireworks"></div>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        var hamsterImages = [
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/hamster01.jpg',
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/hamster02.jpg',
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/hamster03.jpg',
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/hamster04.jpg',
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/hamster05.jpg',
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/hamster06.jpg',
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/hamster07.jpg',
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/hamster08.jpg',
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/hamster09.jpg',
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/hamster10.jpg',
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/hamster11.jpg',
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/hamster12.jpg'
        ];
        
        var cardBackImage = 'https://hamuchiranagaya.github.io/hamuketsu-cardgame/cardback.jpg';
        
        var rewardImages = [
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/reward01.jpg',
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/reward02.jpg',
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/reward03.jpg',
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/reward04.jpg',
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/reward05.jpg',
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/reward06.jpg',
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/reward07.jpg',
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/reward08.jpg',
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/reward09.jpg',
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/reward10.jpg'
        ];

        var rewardNames = [
            'ã½ã‚“ã‚±ãƒ„', 'ã›ãã¡ãƒ¼ã‚±ãƒ„', 'é»„é‡‘æ¯”ã‚±ãƒ„', 
            'ã‚·ã‚´ãƒ‡ã‚­ã‚±ãƒ„', 'ã‚ªãƒ¬ã‚±ãƒ„', 'ã“ã‚“ã‚±ãƒ„',
            'ã‚„ã°ã‚±ãƒ„', 'ãµãƒãªã‚±ãƒ„', 'ãã„ã‚±ãƒ„', 'ãƒ›ãƒ¯ã“ãµã‚±ãƒ„'
        ];

        // PWAã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«é–¢é€£
        var deferredPrompt;
        var installButton = document.getElementById('install-btn');

        // ã‚²ãƒ¼ãƒ çŠ¶æ…‹
        var currentStage = 1;
        var currentRound = 1;
        var flippedCards = [];
        var matchedPairs = 0;
        var attempts = 0;
        var maxAttempts = 5;
        var remainingAttempts = 5;
        var isChecking = false;
        var completedStages = [];
        var startTime = 0;
        var gameTime = 0;
        var gameStarted = false;

        // ã‚¹ã‚¿ãƒŸãƒŠã‚·ã‚¹ãƒ†ãƒ  
        var sunflowerSeeds = 6;
        var maxSunflowerSeeds = 6;
        var lastStaminaUpdate = Date.now();
        var rewardStock = {};

        // ã‚¹ãƒ†ãƒ¼ã‚¸è¨­å®š
        var stageConfig = {
            1: { cards: 6, pairs: 3, rounds: 3, maxAttempts: 5 },
            2: { cards: 8, pairs: 4, rounds: 3, maxAttempts: 5 },
            3: { cards: 10, pairs: 5, rounds: 3, maxAttempts: 5 },
            4: { cards: 12, pairs: 6, rounds: 3, maxAttempts: 5 },
            5: { cards: 14, pairs: 7, rounds: 3, maxAttempts: 5 },
            6: { cards: 16, pairs: 8, rounds: 3, maxAttempts: 5 },
            7: { cards: 18, pairs: 9, rounds: 3, maxAttempts: 5 },
            8: { cards: 20, pairs: 10, rounds: 3, maxAttempts: 5 },
            9: { cards: 22, pairs: 11, rounds: 3, maxAttempts: 5 },
            10: { cards: 24, pairs: 12, rounds: 3, maxAttempts: 5 },
            11: { cards: 20, pairs: 10, rounds: 1, maxAttempts: 10, isSpecial: true } // ã‚¹ãƒšã‚·ãƒ£ãƒ«ã‚¹ãƒ†ãƒ¼ã‚¸
        };

        // PWAã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ©Ÿèƒ½
        window.addEventListener('beforeinstallprompt', function(e) {
            console.log('beforeinstallprompt ã‚¤ãƒ™ãƒ³ãƒˆç™ºç”Ÿ');
            e.preventDefault();
            deferredPrompt = e;
            installButton.style.display = 'inline-block';
        });

        installButton.addEventListener('click', function() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then(function(choiceResult) {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒPWAã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’æ‰¿èª');
                    } else {
                        console.log('ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒPWAã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’æ‹’å¦');
                    }
                    deferredPrompt = null;
                    installButton.style.display = 'none';
                });
            }
        });

        // ã‚¢ãƒ—ãƒªãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ã®å ´åˆã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒœã‚¿ãƒ³ã‚’éè¡¨ç¤º
        window.addEventListener('appinstalled', function(e) {
            console.log('PWAãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¾ã—ãŸ');
            installButton.style.display = 'none';
        });

        // åˆæœŸåŒ–
        function init() {
            console.log('ã‚²ãƒ¼ãƒ åˆæœŸåŒ–é–‹å§‹');
            loadGameData();
            updateStamina();
            createStageSelector();
            startStage(currentStage, currentRound);
            setInterval(updateStamina, 60000);
            setInterval(updateStaminaDisplay, 1000);
            
            // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
            setupEventListeners();
        }

        function setupEventListeners() {
            document.getElementById('game-start-btn').addEventListener('click', startGame);
            document.getElementById('reward-list-btn').addEventListener('click', showRewardList);
            document.getElementById('collection-btn').addEventListener('click', showCollection);
            document.getElementById('close-reward-list').addEventListener('click', closeRewardList);
            document.getElementById('close-collection').addEventListener('click', closeCollection);
            document.getElementById('close-reward-detail').addEventListener('click', closeRewardDetail);
            document.getElementById('retry-btn').addEventListener('click', retryWithSeed);
            document.getElementById('give-up-btn').addEventListener('click', showGiveUpConfirm);
            document.getElementById('give-up-cancel').addEventListener('click', cancelGiveUp);
            document.getElementById('give-up-confirm').addEventListener('click', confirmGiveUp);
            document.getElementById('next-stage-btn').addEventListener('click', nextStage);
            document.getElementById('share-twitter').addEventListener('click', shareToTwitter);
            document.getElementById('share-line').addEventListener('click', shareToLine);
        }

        // ã‚²ãƒ¼ãƒ é–‹å§‹
        function startGame() {
            console.log('ã‚²ãƒ¼ãƒ é–‹å§‹');
            var isCleared = completedStages.indexOf(currentStage + '-' + currentRound) !== -1;
            
            if (!isCleared && sunflowerSeeds <= 0) {
                alert('ğŸŒ» ã²ã¾ç¨®ãŒè¶³ã‚Šã¾ã›ã‚“ï¼æ™‚é–“ã‚’ãŠã„ã¦å†æŒ‘æˆ¦ã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            
            if (!isCleared) {
                sunflowerSeeds--;
                saveGameData();
                updateStaminaDisplay();
            }
            
            gameStarted = true;
            startTime = Date.now();
            
            document.getElementById('game-start-section').style.display = 'none';
            document.getElementById('game-board').style.display = 'grid';
            document.getElementById('attempts-counter').style.display = 'block';
            
            updateAttemptsDisplay();
        }

        // ã‚¹ãƒ†ãƒ¼ã‚¸é–‹å§‹
        function startStage(stage, round) {
            if (!canAccessStage(stage, round)) {
                alert('å‰ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã‚’ã‚¯ãƒªã‚¢ã—ã¦ãã ã•ã„ï¼');
                return;
            }
            
            currentStage = stage;
            currentRound = round;
            matchedPairs = 0;
            attempts = 0;
            flippedCards = [];
            isChecking = false;
            gameStarted = false;
            maxAttempts = stageConfig[stage].maxAttempts;
            remainingAttempts = maxAttempts;
            
            updateUI();
            createGameBoard();
            createStageSelector();
            
            document.getElementById('game-start-section').style.display = 'block';
            document.getElementById('game-board').style.display = 'none';
            document.getElementById('attempts-counter').style.display = 'none';
            updateStartButton();
        }

        function canAccessStage(stage, round) {
            if (stage === 1 && round === 1) return true;
            
            // ã‚¹ãƒšã‚·ãƒ£ãƒ«ã‚¹ãƒ†ãƒ¼ã‚¸ï¼ˆã‚¹ãƒ†ãƒ¼ã‚¸11ï¼‰ã®ã‚¢ã‚¯ã‚»ã‚¹æ¡ä»¶
            if (stage === 11) {
                return hasAllRewards();
            }
            
            if (round > 1) {
                return completedStages.indexOf(stage + '-' + (round - 1)) !== -1;
            }
            
            return completedStages.indexOf((stage - 1) + '-3') !== -1;
        }

        function hasAllRewards() {
            // å…¨å ±é…¬ï¼ˆ1-10ã‚¹ãƒ†ãƒ¼ã‚¸ã‚¯ãƒªã‚¢ï¼‰ã‚’æŒã£ã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
            for (var i = 0; i < 10; i++) {
                var rewardName = rewardNames[i];
                if (!rewardStock[rewardName] || rewardStock[rewardName] === 0) {
                    return false;
                }
            }
            return true;
        }

        function createStageSelector() {
            var selector = document.getElementById('stage-selector');
            selector.innerHTML = '';
            
            // é€šå¸¸ã‚¹ãƒ†ãƒ¼ã‚¸ï¼ˆ1-10ï¼‰
            for (var stage = 1; stage <= 10; stage++) {
                for (var round = 1; round <= 3; round++) {
                    var btn = document.createElement('button');
                    btn.className = 'stage-btn';
                    btn.textContent = stage + '-' + round;
                    
                    var isLocked = !canAccessStage(stage, round);
                    var isCompleted = completedStages.indexOf(stage + '-' + round) !== -1;
                    var isActive = stage === currentStage && round === currentRound;
                    
                    if (isLocked) {
                        btn.classList.add('locked');
                        btn.onclick = function() { alert('å‰ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã‚’ã‚¯ãƒªã‚¢ã—ã¦ãã ã•ã„ï¼'); };
                    } else {
                        btn.onclick = (function(s, r) {
                            return function() { startStage(s, r); };
                        })(stage, round);
                    }
                    
                    if (isCompleted) btn.classList.add('completed');
                    if (isActive) btn.classList.add('active');
                    
                    selector.appendChild(btn);
                }
            }

            // ã‚¹ãƒšã‚·ãƒ£ãƒ«ã‚¹ãƒ†ãƒ¼ã‚¸
            var specialBtn = document.createElement('button');
            specialBtn.className = 'stage-btn';
            specialBtn.textContent = 'ğŸ†SPğŸ†';
            specialBtn.style.background = 'linear-gradient(45deg, #ffd700, #ffb347)';
            specialBtn.style.color = '#333';
            specialBtn.style.fontWeight = 'bold';
            
            var canAccessSpecial = canAccessStage(11, 1);
            var isSpecialCompleted = completedStages.indexOf('11-1') !== -1;
            var isSpecialActive = currentStage === 11;
            
            if (!canAccessSpecial) {
                specialBtn.classList.add('locked');
                specialBtn.style.background = 'rgba(128,128,128,0.5)';
                specialBtn.style.color = '#666';
                specialBtn.onclick = function() { alert('å…¨å ±é…¬ã‚’é›†ã‚ã¦ã‚¹ãƒšã‚·ãƒ£ãƒ«ã‚¹ãƒ†ãƒ¼ã‚¸ã‚’è§£æ”¾ã—ã‚ˆã†ï¼'); };
            } else {
                specialBtn.onclick = function() { startStage(11, 1); };
            }
            
            if (isSpecialCompleted) {
                specialBtn.classList.add('completed');
                specialBtn.style.background = 'linear-gradient(45deg, #4caf50, #45a049)';
                specialBtn.style.color = 'white';
            }
            if (isSpecialActive) {
                specialBtn.classList.add('active');
                specialBtn.style.background = 'rgba(255,255,255,0.9)';
                specialBtn.style.color = '#333';
            }
            
            selector.appendChild(specialBtn);
        }

        function createGameBoard() {
            var board = document.getElementById('game-board');
            board.innerHTML = '';
            
            var config = stageConfig[currentStage];
            var cardCount = config.cards;
            var pairCount = config.pairs;
            
            // ä¸€ç”»é¢ã«åã¾ã‚‹ã‚ˆã†ã«åˆ—æ•°ã‚’æ±ºå®š
            var columns;
            if (cardCount <= 9) {
                // 6æš(2è¡Œ) or 8æš(3è¡Œ) or 9æš(3è¡Œ) â†’ 3åˆ—
                columns = 3;
            } else if (cardCount <= 16) {
                // 10-16æš â†’ 4åˆ— (æœ€å¤§4è¡Œ)
                columns = 4;
            } else {
                // 18æšä»¥ä¸Š â†’ 4åˆ— (5è¡Œä»¥ä¸Šã«ãªã‚‹ãŒä»•æ–¹ãªã—)
                columns = 4;
            }
            
            board.style.gridTemplateColumns = 'repeat(' + columns + ', 1fr)';

            // ã‚«ãƒ¼ãƒ‰ãƒšã‚¢ä½œæˆ
            var cardPairs = [];
            
            // ã‚¹ãƒšã‚·ãƒ£ãƒ«ã‚¹ãƒ†ãƒ¼ã‚¸ã¯å ±é…¬ã‚«ãƒ¼ãƒ‰ã‚’ä½¿ç”¨
            if (currentStage === 11) {
                for (var i = 0; i < pairCount; i++) {
                    cardPairs.push(i, i);
                }
            } else {
                // é€šå¸¸ã‚¹ãƒ†ãƒ¼ã‚¸ã¯ãƒãƒ ã‚¹ã‚¿ãƒ¼ç”»åƒã‚’ä½¿ç”¨
                for (var i = 0; i < pairCount; i++) {
                    var imageIndex = i % hamsterImages.length;
                    cardPairs.push(imageIndex, imageIndex);
                }
            }

            shuffleArray(cardPairs);

            for (var i = 0; i < cardPairs.length; i++) {
                var card = createCard(cardPairs[i], i);
                board.appendChild(card);
            }
        }

        function createCard(imageIndex, cardIndex) {
            var card = document.createElement('div');
            card.className = 'card';
            card.dataset.imageIndex = imageIndex;
            card.dataset.cardIndex = cardIndex;
            card.onclick = function() { flipCard(card); };

            var cardBack = document.createElement('div');
            cardBack.className = 'card-face card-back';
            
            var cardFront = document.createElement('div');
            cardFront.className = 'card-face card-front';

            if (cardBackImage) {
                var backImg = document.createElement('img');
                backImg.src = cardBackImage;
                backImg.className = 'back-card-image';
                cardBack.appendChild(backImg);
            } else {
                cardBack.textContent = '?';
                cardBack.style.fontSize = '3rem';
                cardBack.style.color = 'white';
            }

            // ã‚¹ãƒšã‚·ãƒ£ãƒ«ã‚¹ãƒ†ãƒ¼ã‚¸ã¯å ±é…¬ç”»åƒã€é€šå¸¸ã‚¹ãƒ†ãƒ¼ã‚¸ã¯ãƒãƒ ã‚¹ã‚¿ãƒ¼ç”»åƒ
            var imageUrl;
            if (currentStage === 11) {
                imageUrl = rewardImages[imageIndex];
            } else {
                imageUrl = hamsterImages[imageIndex];
            }

            if (imageUrl) {
                var frontImg = document.createElement('img');
                frontImg.src = imageUrl;
                frontImg.className = 'card-image';
                cardFront.appendChild(frontImg);
            }

            card.appendChild(cardBack);
            card.appendChild(cardFront);

            return card;
        }

        function flipCard(card) {
            if (!gameStarted || isChecking || card.classList.contains('flipped') || card.classList.contains('matched')) {
                return;
            }

            card.classList.add('flipped');
            flippedCards.push(card);

            if (flippedCards.length === 2) {
                attempts++;
                updateUI();
                checkMatch();
            }
        }

        function checkMatch() {
            isChecking = true;
            var card1 = flippedCards[0];
            var card2 = flippedCards[1];
            
            setTimeout(function() {
                if (card1.dataset.imageIndex === card2.dataset.imageIndex) {
                    card1.classList.add('matched');
                    card2.classList.add('matched');
                    matchedPairs++;
                    
                    if (matchedPairs === stageConfig[currentStage].pairs) {
                        setTimeout(function() { completeStage(); }, 500);
                    }
                } else {
                    card1.classList.remove('flipped');
                    card2.classList.remove('flipped');
                    
                    remainingAttempts--;
                    updateAttemptsDisplay();
                    
                    if (remainingAttempts <= 0) {
                        setTimeout(function() { gameOver(); }, 500);
                    }
                }
                
                flippedCards = [];
                isChecking = false;
                updateUI();
            }, 1000);
        }

        function completeStage() {
            var stageKey = currentStage + '-' + currentRound;
            if (completedStages.indexOf(stageKey) === -1) {
                completedStages.push(stageKey);
            }
            gameTime = Math.floor((Date.now() - startTime) / 1000);
            
            // èŠ±ç«ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
            createFireworks();
            
            if (currentStage === 11) {
                // ã‚¹ãƒšã‚·ãƒ£ãƒ«ã‚¹ãƒ†ãƒ¼ã‚¸ã‚¯ãƒªã‚¢
                // ç‰¹åˆ¥ãªå ±é…¬ã¯ç„¡ã—ã€é”æˆæ„Ÿã®ã¿
            } else if (currentRound === 3) {
                maxSunflowerSeeds += 3;
                sunflowerSeeds = Math.min(sunflowerSeeds + 3, maxSunflowerSeeds);
                lastStaminaUpdate = Date.now();
                
                var rewardName = rewardNames[currentStage - 1];
                if (!rewardStock[rewardName]) {
                    rewardStock[rewardName] = 0;
                }
                rewardStock[rewardName]++;
            }
            
            saveGameData();
            updateStaminaDisplay();
            
            // ã‚¯ãƒªã‚¢ç”»é¢è¡¨ç¤º
            if (currentStage === 11) {
                document.getElementById('completed-stage').textContent = 'ã‚¹ãƒšã‚·ãƒ£ãƒ«ã‚¹ãƒ†ãƒ¼ã‚¸';
            } else {
                document.getElementById('completed-stage').textContent = stageKey;
            }
            document.getElementById('clear-time').textContent = gameTime;
            
            if (currentStage === 11) {
                document.getElementById('reward-section').style.display = 'none';
            } else if (currentRound === 3) {
                document.getElementById('reward-section').style.display = 'block';
                document.getElementById('reward-image').src = rewardImages[currentStage - 1];
                document.getElementById('reward-name').textContent = rewardNames[currentStage - 1];
            } else {
                document.getElementById('reward-section').style.display = 'none';
            }
            
            document.getElementById('stage-complete').style.display = 'flex';
        }

        function nextStage() {
            document.getElementById('stage-complete').style.display = 'none';
            
            if (currentStage === 11) {
                alert('ğŸ‰ ã‚¹ãƒšã‚·ãƒ£ãƒ«ã‚¹ãƒ†ãƒ¼ã‚¸ã‚¯ãƒªã‚¢ï¼çœŸã®ãƒã‚¹ã‚¿ãƒ¼ã§ã™ï¼ ğŸ‰');
                startStage(1, 1); // æœ€åˆã«æˆ»ã‚‹
            } else if (currentRound < 3) {
                startStage(currentStage, currentRound + 1);
            } else if (currentStage < 10) {
                startStage(currentStage + 1, 1);
            } else {
                // å…¨ã‚¹ãƒ†ãƒ¼ã‚¸ã‚¯ãƒªã‚¢å¾Œã€ã‚¹ãƒšã‚·ãƒ£ãƒ«ã‚¹ãƒ†ãƒ¼ã‚¸ãŒã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
                if (hasAllRewards()) {
                    alert('ğŸ‰ å…¨ã‚¹ãƒ†ãƒ¼ã‚¸ã‚¯ãƒªã‚¢ï¼ã‚¹ãƒšã‚·ãƒ£ãƒ«ã‚¹ãƒ†ãƒ¼ã‚¸ãŒè§£æ”¾ã•ã‚Œã¾ã—ãŸï¼ ğŸ†');
                    startStage(11, 1);
                } else {
                    alert('ğŸ‰ å…¨ã‚¹ãƒ†ãƒ¼ã‚¸ã‚¯ãƒªã‚¢ï¼ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼ ğŸ‰');
                }
            }
        }

        function createFireworks() {
            var fireworks = document.getElementById('fireworks');
            
            for (var i = 0; i < 50; i++) {
                setTimeout(function(index) {
                    var firework = document.createElement('div');
                    firework.className = 'firework';
                    firework.style.left = Math.random() * 100 + '%';
                    firework.style.top = Math.random() * 100 + '%';
                    firework.style.background = 'hsl(' + Math.random() * 360 + ', 70%, 60%)';
                    fireworks.appendChild(firework);
                    
                    setTimeout(function() {
                        if (firework.parentNode) {
                            firework.parentNode.removeChild(firework);
                        }
                    }, 1000);
                }, i * 100);
            }
        }

        function shareToTwitter() {
            var showReward = currentRound === 3 || (currentStage === 11);
            var text;
            var gameUrl = 'https://hamuchiranagaya.github.io/hamuketsu-cardgame/';
            
            if (currentStage === 11) {
                text = 'ã‚¹ãƒšã‚·ãƒ£ãƒ«ã‚¹ãƒ†ãƒ¼ã‚¸ã‚’' + gameTime + 'ç§’ã§ã‚¯ãƒªã‚¢âœ¨ğŸ† #ã¯ã‚€ã‚±ãƒ„ç¥çµŒè¡°å¼± #ãƒãƒ ã‚¹ã‚¿ãƒ¼ #ã¯ã‚€ãƒãƒ©\n' + gameUrl;
            } else if (showReward) {
                var rewardName = rewardNames[currentStage - 1];
                text = currentStage + 'ã‚¹ãƒ†ãƒ¼ã‚¸ ' + gameTime + 'ç§’ã§ã‚¯ãƒªã‚¢âœ¨å ±é…¬' + rewardName + 'ã‚’ã‚²ãƒƒãƒˆğŸ¹ #ã¯ã‚€ã‚±ãƒ„ç¥çµŒè¡°å¼± #ãƒãƒ ã‚¹ã‚¿ãƒ¼ #ã¯ã‚€ãƒãƒ©\n' + gameUrl;
            } else {
                text = currentStage + '-' + currentRound + ' ' + gameTime + 'ç§’ã§ã‚¯ãƒªã‚¢âœ¨ #ã¯ã‚€ã‚±ãƒ„ç¥çµŒè¡°å¼± #ãƒãƒ ã‚¹ã‚¿ãƒ¼ #ã¯ã‚€ãƒãƒ©\n' + gameUrl;
            }
            
            var url = 'https://twitter.com/intent/tweet?text=' + encodeURIComponent(text);
            window.open(url, '_blank');
        }

        function shareToLine() {
            var showReward = currentRound === 3 || (currentStage === 11);
            var text;
            var gameUrl = 'https://hamuchiranagaya.github.io/hamuketsu-cardgame/';
            
            if (currentStage === 11) {
                text = 'ã‚¹ãƒšã‚·ãƒ£ãƒ«ã‚¹ãƒ†ãƒ¼ã‚¸ã‚’' + gameTime + 'ç§’ã§ã‚¯ãƒªã‚¢âœ¨ğŸ†';
            } else if (showReward) {
                var rewardName = rewardNames[currentStage - 1];
                text = currentStage + 'ã‚¹ãƒ†ãƒ¼ã‚¸ ' + gameTime + 'ç§’ã§ã‚¯ãƒªã‚¢âœ¨å ±é…¬' + rewardName + 'ã‚’ã‚²ãƒƒãƒˆğŸ¹';
            } else {
                text = currentStage + '-' + currentRound + ' ' + gameTime + 'ç§’ã§ã‚¯ãƒªã‚¢âœ¨';
            }
            
            var url = 'https://social-plugins.line.me/lineit/share?url=' + encodeURIComponent(gameUrl) + '&text=' + encodeURIComponent(text);
            window.open(url, '_blank');
        }

        function gameOver() {
            document.getElementById('remaining-seeds').textContent = sunflowerSeeds;
            
            var retryBtn = document.getElementById('retry-btn');
            if (sunflowerSeeds <= 0) {
                retryBtn.disabled = true;
                retryBtn.textContent = 'ã²ã¾ç¨®ä¸è¶³';
                retryBtn.classList.add('retry-btn');
            } else {
                retryBtn.disabled = false;
                retryBtn.textContent = 'ã²ã¾ç¨®ã§+5å›';
                retryBtn.classList.remove('retry-btn');
            }
            
            document.getElementById('game-over').style.display = 'flex';
        }

        function retryWithSeed() {
            if (sunflowerSeeds <= 0) {
                alert('ã²ã¾ç¨®ãŒè¶³ã‚Šã¾ã›ã‚“ï¼');
                return;
            }
            
            // ã²ã¾ç¨®æ¶ˆè²»ã—ã¦è©¦è¡Œå›æ•°+5å›
            sunflowerSeeds--;
            remainingAttempts += 5;
            saveGameData();
            updateStaminaDisplay();
            updateAttemptsDisplay();
            
            // ã‚²ãƒ¼ãƒ ç¶™ç¶šï¼ˆã‚«ãƒ¼ãƒ‰ã®çŠ¶æ…‹ã¯ä¿æŒï¼‰
            isChecking = false;
            document.getElementById('game-over').style.display = 'none';
        }

        function showGiveUpConfirm() {
            console.log('è«¦ã‚ã‚‹ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚Œã¾ã—ãŸ - ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º'); // ãƒ‡ãƒãƒƒã‚°ç”¨
            var modal = document.getElementById('give-up-confirm-modal');
            if (modal) {
                // ä»–ã®ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’ç¢ºå®Ÿã«é–‰ã˜ã‚‹
                document.getElementById('game-over').style.display = 'none';
                
                // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’æœ€å‰é¢ã«è¡¨ç¤º
                modal.style.display = 'flex';
                modal.style.zIndex = '9999';
                modal.style.position = 'fixed';
                modal.style.top = '0';
                modal.style.left = '0';
                modal.style.width = '100%';
                modal.style.height = '100%';
                modal.style.backgroundColor = 'rgba(0,0,0,0.8)';
                
                console.log('ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤ºå®Œäº†');
                console.log('modal.style.display:', modal.style.display);
                console.log('modal.style.zIndex:', modal.style.zIndex);
            } else {
                console.log('ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
            }
        }

        function cancelGiveUp() {
            console.log('è«¦ã‚ã‚‹ãŒã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã¾ã—ãŸ'); // ãƒ‡ãƒãƒƒã‚°ç”¨
            document.getElementById('give-up-confirm-modal').style.display = 'none';
            // ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ç”»é¢ã«æˆ»ã‚‹
            document.getElementById('game-over').style.display = 'flex';
        }

        function confirmGiveUp() {
            console.log('è«¦ã‚ã‚‹ãŒç¢ºå®šã•ã‚Œã¾ã—ãŸ'); // ãƒ‡ãƒãƒƒã‚°ç”¨
            document.getElementById('give-up-confirm-modal').style.display = 'none';
            document.getElementById('game-over').style.display = 'none';
            // æœ€åˆã®ã‚¹ãƒ†ãƒ¼ã‚¸ã«æˆ»ã‚‹
            startStage(1, 1);
        }

        function updateAttemptsDisplay() {
            var attemptsElement = document.getElementById('remaining-attempts');
            var displayElement = document.querySelector('.attempts-display');
            
            if (attemptsElement && displayElement) {
                attemptsElement.textContent = remainingAttempts;
                
                if (remainingAttempts <= 1) {
                    displayElement.classList.add('attempts-warning');
                } else {
                    displayElement.classList.remove('attempts-warning');
                }
            }
        }

        function updateUI() {
            if (currentStage === 11) {
                document.getElementById('current-stage').textContent = 'ã‚¹ãƒšã‚·ãƒ£ãƒ«';
            } else {
                document.getElementById('current-stage').textContent = currentStage + '-' + currentRound;
            }
            document.getElementById('card-count').textContent = stageConfig[currentStage].cards;
            document.getElementById('pairs-found').textContent = matchedPairs;
            document.getElementById('total-pairs').textContent = stageConfig[currentStage].pairs;
            document.getElementById('attempts').textContent = attempts;
        }

        function updateStaminaDisplay() {
            document.getElementById('sunflower-count').textContent = sunflowerSeeds + '/' + maxSunflowerSeeds;
            
            var timerElement = document.getElementById('stamina-timer');
            var recoveryTimeElement = document.getElementById('recovery-time');
            
            if (sunflowerSeeds < maxSunflowerSeeds) {
                var nextRecoveryTime = lastStaminaUpdate + (30 * 60 * 1000);
                var timeUntilRecovery = Math.max(0, nextRecoveryTime - Date.now());
                var minutes = Math.floor(timeUntilRecovery / 60000);
                var seconds = Math.floor((timeUntilRecovery % 60000) / 1000);
                
                recoveryTimeElement.textContent = minutes + ':' + (seconds < 10 ? '0' : '') + seconds;
                timerElement.style.display = 'block';
            } else {
                timerElement.style.display = 'none';
            }
            
            updateStartButton();
        }

        function updateStartButton() {
            var startBtn = document.getElementById('game-start-btn');
            var isCleared = completedStages.indexOf(currentStage + '-' + currentRound) !== -1;
            
            if (!isCleared && sunflowerSeeds <= 0) {
                startBtn.disabled = true;
                startBtn.textContent = 'ã²ã¾ç¨®ä¸è¶³';
            } else {
                startBtn.disabled = false;
                startBtn.textContent = 'ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆï¼';
            }
        }

        function updateStamina() {
            var now = Date.now();
            var timeDiff = now - lastStaminaUpdate;
            var recoveredSeeds = Math.floor(timeDiff / (30 * 60 * 1000));
            
            if (recoveredSeeds > 0 && sunflowerSeeds < maxSunflowerSeeds) {
                sunflowerSeeds = Math.min(maxSunflowerSeeds, sunflowerSeeds + recoveredSeeds);
                lastStaminaUpdate = now;
                saveGameData();
            }
            
            updateStaminaDisplay();
        }

        function loadGameData() {
            try {
                // LocalStorageãŒåˆ©ç”¨å¯èƒ½ã‹ãƒã‚§ãƒƒã‚¯
                if (typeof(Storage) !== "undefined" && localStorage) {
                    var savedData = localStorage.getItem('hamuketsu-game-data');
                    if (savedData && savedData !== 'null' && savedData !== 'undefined') {
                        var data = JSON.parse(savedData);
                        sunflowerSeeds = data.sunflowerSeeds || 6;
                        maxSunflowerSeeds = data.maxSunflowerSeeds || 6;
                        lastStaminaUpdate = data.lastStaminaUpdate || Date.now();
                        rewardStock = data.rewardStock || {};
                        completedStages = data.completedStages || [];
                        currentStage = data.currentStage || 1;
                        currentRound = data.currentRound || 1;
                        console.log('ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿æˆåŠŸ');
                        return;
                    }
                }
                
                // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¨­å®š
                sunflowerSeeds = 6;
                maxSunflowerSeeds = 6;
                lastStaminaUpdate = Date.now();
                rewardStock = {};
                completedStages = [];
                currentStage = 1;
                currentRound = 1;
                console.log('ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ‡ãƒ¼ã‚¿ã§åˆæœŸåŒ–å®Œäº†');
            } catch (e) {
                console.log('ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', e);
                // ã‚¨ãƒ©ãƒ¼æ™‚ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¨­å®š
                sunflowerSeeds = 6;
                maxSunflowerSeeds = 6;
                lastStaminaUpdate = Date.now();
                rewardStock = {};
                completedStages = [];
                currentStage = 1;
                currentRound = 1;
            }
        }

        function saveGameData() {
            try {
                // LocalStorageãŒåˆ©ç”¨å¯èƒ½ã‹ãƒã‚§ãƒƒã‚¯
                if (typeof(Storage) !== "undefined" && localStorage) {
                    var data = {
                        sunflowerSeeds: sunflowerSeeds,
                        maxSunflowerSeeds: maxSunflowerSeeds,
                        lastStaminaUpdate: lastStaminaUpdate,
                        rewardStock: rewardStock,
                        completedStages: completedStages,
                        currentStage: currentStage,
                        currentRound: currentRound
                    };
                    localStorage.setItem('hamuketsu-game-data', JSON.stringify(data));
                    console.log('ãƒ‡ãƒ¼ã‚¿ä¿å­˜æˆåŠŸ');
                } else {
                    console.log('LocalStorageåˆ©ç”¨ä¸å¯');
                }
            } catch (e) {
                console.log('ãƒ‡ãƒ¼ã‚¿ä¿å­˜ã‚¨ãƒ©ãƒ¼:', e);
                // LocalStorageãŒä½¿ãˆãªã„å ´åˆã¯ä½•ã‚‚ã—ãªã„
            }
        }

        function shuffleCards() {
            if (!gameStarted) {
                createGameBoard();
            } else {
                if (confirm('ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã™ã‚‹ã¨ã‚²ãƒ¼ãƒ ã‚’ã‚„ã‚Šç›´ã—ã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ')) {
                    startStage(currentStage, currentRound);
                }
            }
        }

        function resetGame() {
            if (confirm('ã‚²ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ\nï¼ˆå ±é…¬ã€ã²ã¾ç¨®ã€ã‚¯ãƒªã‚¢çŠ¶æ³ãŒãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã™ï¼‰')) {
                localStorage.removeItem('hamuketsu-game-data');
                sunflowerSeeds = 3;
                maxSunflowerSeeds = 3;
                lastStaminaUpdate = Date.now();
                rewardStock = {};
                completedStages = [];
                currentStage = 1;
                currentRound = 1;
                saveGameData();
                updateStaminaDisplay();
                startStage(1, 1);
            }
        }

        function showRewardList() {
            console.log('ã‚¯ãƒªã‚¢å ±é…¬ä¸€è¦§ã‚’è¡¨ç¤º');
            var modal = document.getElementById('reward-list-modal');
            var grid = document.getElementById('reward-list-grid');
            
            grid.innerHTML = '';
            
            for (var i = 0; i < rewardNames.length; i++) {
                var item = document.createElement('div');
                item.className = 'reward-item';
                item.style.padding = '20px';
                
                var nameDiv = document.createElement('div');
                nameDiv.className = 'reward-name';
                nameDiv.textContent = rewardNames[i];
                nameDiv.style.fontSize = '16px';
                nameDiv.style.fontWeight = 'bold';
                nameDiv.style.marginBottom = '10px';
                
                var stageDiv = document.createElement('div');
                stageDiv.textContent = 'ã‚¹ãƒ†ãƒ¼ã‚¸' + (i + 1) + 'ã‚¯ãƒªã‚¢å ±é…¬';
                stageDiv.style.fontSize = '14px';
                stageDiv.style.color = '#666';
                
                var statusDiv = document.createElement('div');
                statusDiv.textContent = 'ç”»åƒã¯ç²å¾—å¾Œã®ãŠæ¥½ã—ã¿â™ª';
                statusDiv.style.fontSize = '12px';
                statusDiv.style.color = '#999';
                statusDiv.style.marginTop = '5px';
                
                item.appendChild(nameDiv);
                item.appendChild(stageDiv);
                item.appendChild(statusDiv);
                grid.appendChild(item);
            }
            
            modal.style.display = 'flex';
        }

        function closeRewardList() {
            document.getElementById('reward-list-modal').style.display = 'none';
        }

        function showCollection() {
            console.log('å ±é…¬å›³é‘‘ã‚’è¡¨ç¤º');
            var modal = document.getElementById('collection-modal');
            var grid = document.getElementById('collection-grid');
            
            grid.innerHTML = '';
            
            for (var i = 0; i < rewardNames.length; i++) {
                var count = rewardStock[rewardNames[i]] || 0;
                var item = document.createElement('div');
                item.className = 'reward-item';
                
                var img = document.createElement('img');
                
                if (count > 0) {
                    // æ‰‹ã«å…¥ã‚ŒãŸå ±é…¬ã¯å®Ÿéš›ã®ç”»åƒã‚’è¡¨ç¤º
                    img.src = rewardImages[i] || '';
                    item.style.opacity = '1';
                    item.style.cursor = 'pointer';
                    
                    // ã‚¯ãƒªãƒƒã‚¯ã§æ‹¡å¤§è¡¨ç¤º
                    item.onclick = (function(index, rewardName, rewardCount) {
                        return function() {
                            showRewardDetail(index, rewardName, rewardCount);
                        };
                    })(i, rewardNames[i], count);
                } else {
                    // æ‰‹ã«å…¥ã‚Œã¦ã„ãªã„å ±é…¬ã¯ã‚«ãƒ¼ãƒ‰ãƒãƒƒã‚¯ç”»åƒã‚’è¡¨ç¤º
                    img.src = cardBackImage || '';
                    item.style.opacity = '0.6';
                    item.style.cursor = 'default';
                }
                
                img.alt = rewardNames[i];
                
                var nameDiv = document.createElement('div');
                nameDiv.className = 'reward-name';
                nameDiv.textContent = rewardNames[i]; // å ±é…¬åã¯å¸¸ã«è¡¨ç¤º
                
                var countDiv = document.createElement('div');
                countDiv.className = 'reward-count';
                countDiv.textContent = 'Ã—' + count;
                
                item.appendChild(img);
                item.appendChild(nameDiv);
                item.appendChild(countDiv);
                grid.appendChild(item);
            }
            
            modal.style.display = 'flex';
        }

        function showRewardDetail(index, name, count) {
            var modal = document.getElementById('reward-detail-modal');
            
            document.getElementById('reward-detail-name').textContent = name;
            document.getElementById('reward-detail-image').src = rewardImages[index];
            document.getElementById('reward-detail-count').textContent = 'æ‰€æŒæ•°: Ã—' + count;
            
            modal.style.display = 'flex';
        }

        function closeRewardDetail() {
            document.getElementById('reward-detail-modal').style.display = 'none';
        }

        function closeCollection() {
            document.getElementById('collection-modal').style.display = 'none';
        }

        function shuffleArray(array) {
            for (var i = array.length - 1; i > 0; i--) {
                var j = Math.floor(Math.random() * (i + 1));
                var temp = array[i];
                array[i] = array[j];
                array[j] = temp;
            }
        }

        // åˆæœŸåŒ–å®Ÿè¡Œ
        window.onload = function() {
            console.log('ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†ã€åˆæœŸåŒ–é–‹å§‹');
            init();
        };
    </script>
</body>
</html>