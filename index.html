    <div class="game-over" id="game-over">
        <div class="game-over-card">
            <h2>â° æ™‚é–“åˆ‡ã‚Œï¼ â°</h2>
            <p>åˆ¶é™æ™‚é–“å†…ã«ã‚¯ãƒªã‚¢ã§ãã¾ã›ã‚“ã§ã—ãŸ</p>
            <div style="margin: 20px 0;">
                <p>ğŸŒ» ã²ã¾ç¨®ã‚’1å€‹ä½¿ã£ã¦å†æŒ‘æˆ¦ã—ã¾ã™ã‹ï¼Ÿ</p>
                <p>æ®‹ã‚Š: <span id="remaining-seeds"></span>å€‹</p>
            </div>
            <div style="display: flex; gap: 15px; justify-content: center; margin-top: 20px;">
                <button class="btn btn-primary" onclick="retryWithSeed()" id="retry-btn">ã²ã¾ç¨®ã§å†æŒ‘æˆ¦</button>
                <button class="btn btn-secondary" onclick="giveUpStage()">è«¦ã‚ã‚‹</button>
            </div>
        </div>
    </div>

    <div class="reward-stock-modal" id="reward-stock-modal">
        <div class="reward-stock-content">
            <h2>ğŸ å ±é…¬ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³</h2>
            <div class="reward-stock-grid" id="reward-stock-grid">
                <!-- å ±é…¬ã‚¢ã‚¤ãƒ†ãƒ ã¯JavaScriptã§ç”Ÿæˆ -->
            </div>
            <button class="btn btn-primary" onclick="closeRewardStock()" style="margin-top: 20px; width: 100%;">é–‰ã˜ã‚‹</button>
        </div>
    </div><!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒãƒ ã‚¹ã‚¿ãƒ¼ç¥çµŒè¡°å¼±ã‚²ãƒ¼ãƒ </title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 50%, #fecfef 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .game-header {
            text-align: center;
            margin-bottom: 30px;
            color: #fff;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .game-title {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .game-info {
            display: flex;
            gap: 30px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .info-item {
            background: rgba(255,255,255,0.9);
            padding: 10px 20px;
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            font-weight: bold;
            color: #333;
        }

        .game-board {
            display: grid;
            gap: 10px;
            justify-content: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            max-width: 100%;
            width: 100%;
        }

        .card {
            width: 100%;
            aspect-ratio: 1/1;
            cursor: pointer;
            border-radius: 15px;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
            max-width: 120px;
            justify-self: center;
        }

        .card.flipped {
            transform: rotateY(180deg);
        }

        .card.matched {
            opacity: 1;
            transform: rotateY(180deg);
            box-shadow: 0 0 20px rgba(76, 175, 80, 0.8);
            pointer-events: none;
        }

        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 15px;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .card-back {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transform: rotateY(0deg);
        }

        .card-front {
            transform: rotateY(180deg);
            background: white;
        }

        .card-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 15px;
        }

        .back-card-image {
            width: 80%;
            height: 80%;
            object-fit: contain;
        }

        .controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 20px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .btn-primary {
            background: linear-gradient(45deg, #ff6b6b, #ee5a6f);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .stage-complete {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .complete-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            color: white;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            animation: celebrateIn 0.8s ease-out;
        }

        @keyframes celebrateIn {
            0% {
                transform: scale(0.5) rotate(-10deg);
                opacity: 0;
            }
            100% {
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
        }

        .complete-title {
            font-size: 2.5rem;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .reward-image {
            width: 200px;
            height: 250px;
            object-fit: cover;
            border-radius: 15px;
            margin: 20px 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .reward-text {
            font-size: 1.5rem;
            margin: 20px 0;
        }

        .share-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        .share-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .twitter-btn {
            background: #1da1f2;
        }

        .facebook-btn {
            background: #4267b2;
        }

        .line-btn {
            background: #00c300;
        }

        .share-btn:hover {
            transform: scale(1.05);
        }

        .stage-selector {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 20px;
        }

        .stage-btn {
            padding: 10px 15px;
            border: 2px solid #fff;
            background: rgba(255,255,255,0.2);
            color: white;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .stage-btn.active {
            background: rgba(255,255,255,0.9);
            color: #333;
        }

        .stage-btn.completed {
            background: linear-gradient(45deg, #4caf50, #45a049);
            border-color: #4caf50;
        }

        .stamina-info {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .stamina-item {
            background: rgba(255,255,255,0.9);
            padding: 8px 16px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            font-weight: bold;
            color: #333;
            font-size: 14px;
        }

        .game-timer {
            text-align: center;
            margin: 20px 0;
        }

        .timer-display {
            background: linear-gradient(45deg, #ff6b6b, #ee5a6f);
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 18px;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            display: inline-block;
        }

        .timer-warning {
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .stage-btn.locked {
            background: rgba(128,128,128,0.5);
            color: #666;
            cursor: not-allowed;
            border-color: #999;
        }

        .game-over {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1001;
        }

        .game-over-card {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            color: white;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            animation: slideIn 0.8s ease-out;
        }

        @keyframes slideIn {
            0% {
                transform: translateY(-50px);
                opacity: 0;
            }
            100% {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .reward-stock-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1002;
        }

        .reward-stock-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }

        .reward-stock-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .reward-stock-item {
            text-align: center;
            padding: 10px;
            border-radius: 10px;
            background: #f5f5f5;
        }

        .reward-stock-item img {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 5px;
        }

        .reward-count {
            font-weight: bold;
            color: #333;
        }

        @media (max-width: 480px) {
            .card {
                max-width: 75px;
            }
            
            .game-board {
                gap: 6px;
                padding: 10px;
            }
        }

        .fireworks {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 999;
        }

        .firework {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #ff6b6b;
            border-radius: 50%;
            animation: firework 1s ease-out forwards;
        }

        @keyframes firework {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            100% {
                transform: scale(10);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <div class="game-header">
        <h1 class="game-title">ğŸ¹ ãƒãƒ ã‚±ãƒ„ç¥çµŒè¡°å¼± ğŸ¹</h1>
        <div class="stamina-info">
            <div class="stamina-item">ğŸŒ» ã²ã¾ç¨®: <span id="sunflower-count">3</span></div>
            <div class="stamina-item" id="stamina-timer" style="display: none;">å›å¾©ã¾ã§: <span id="recovery-time"></span></div>
        </div>
    </div>

    <div class="game-board" id="game-board">
        <!-- ã‚«ãƒ¼ãƒ‰ã¯JavaScriptã§ç”Ÿæˆ -->
    </div>

    <div class="game-timer" id="game-timer">
        <div class="timer-display">æ®‹ã‚Šæ™‚é–“: <span id="time-remaining">--</span>ç§’</div>
    </div>

    <div class="game-info">
        <div class="info-item">ã‚¹ãƒ†ãƒ¼ã‚¸: <span id="current-stage">1-1</span></div>
        <div class="info-item">ã‚«ãƒ¼ãƒ‰: <span id="card-count">6</span>æš</div>
        <div class="info-item">ãƒšã‚¢: <span id="pairs-found">0</span>/<span id="total-pairs">3</span></div>
        <div class="info-item">è©¦è¡Œå›æ•°: <span id="attempts">0</span></div>
    </div>

    <div class="stage-selector" id="stage-selector">
        <!-- ã‚¹ãƒ†ãƒ¼ã‚¸ãƒœã‚¿ãƒ³ã¯JavaScriptã§ç”Ÿæˆ -->
    </div>

    <div class="controls">
        <button class="btn btn-primary" onclick="shuffleCards()">ã‚·ãƒ£ãƒƒãƒ•ãƒ«</button>
        <button class="btn btn-secondary" onclick="resetGame()">ãƒªã‚»ãƒƒãƒˆ</button>
        <button class="btn btn-secondary" onclick="showRewardStock()">å ±é…¬ä¸€è¦§</button>
    </div>

    <div class="stage-complete" id="stage-complete">
        <div class="complete-card">
            <h2 class="complete-title">ğŸ‰ ãŠã‚ã§ã¨ã†ï¼ ğŸ‰</h2>
            <p class="reward-text">ã‚¹ãƒ†ãƒ¼ã‚¸ <span id="completed-stage"></span> ã‚’<span id="clear-time"></span>ç§’ã§ã‚¯ãƒªã‚¢ï¼</p>
            <div id="reward-section">
                <img class="reward-image" id="reward-image" src="" alt="å ±é…¬">
                <p class="reward-text">å ±é…¬ã€Œ<span id="reward-name"></span>ã€ã‚’æ‰‹ã«å…¥ã‚ŒãŸï¼</p>
            </div>
            <div class="share-buttons">
                <button class="share-btn twitter-btn" onclick="shareToTwitter()">Twitterã§ã‚·ã‚§ã‚¢</button>
                <button class="share-btn line-btn" onclick="shareToLine()">LINEã§ã‚·ã‚§ã‚¢</button>
            </div>
            <button class="btn btn-primary" onclick="nextStage()" style="margin-top: 20px;">æ¬¡ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã¸</button>
        </div>
    </div>

    <div class="fireworks" id="fireworks"></div>

    <script>
        // ãƒãƒ ã‚¹ã‚¿ãƒ¼ç”»åƒãƒ‡ãƒ¼ã‚¿ï¼ˆå®Ÿéš›ã®ç”»åƒURLã‚’è¨­å®šï¼‰
        const hamsterImages = [
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/hamster01.jpg',
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/hamster02.jpg',
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/hamster03.jpg',
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/hamster04.jpg',
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/hamster05.jpg',
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/hamster06.jpg',
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/hamster07.jpg',
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/hamster08.jpg',
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/hamster09.jpg',
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/hamster10.jpg',
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/hamster11.jpg',
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/hamster12.jpg'
        ];
        
        let cardBackImage = 'https://hamuchiranagaya.github.io/hamuketsu-cardgame/cardback.jpg';
        
        // å ±é…¬ç”»åƒãƒ‡ãƒ¼ã‚¿
        const rewardImages = [
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/reward01.jpg',
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/reward02.jpg',
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/reward03.jpg',
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/reward04.jpg',
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/reward05.jpg',
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/reward06.jpg',
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/reward07.jpg',
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/reward08.jpg',
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/reward09.jpg',
            'https://hamuchiranagaya.github.io/hamuketsu-cardgame/reward10.jpg'
        ];

        // ã‚²ãƒ¼ãƒ çŠ¶æ…‹
        let currentStage = 1;
        let currentRound = 1;
        let flippedCards = [];
        let matchedPairs = 0;
        let attempts = 0;
        let isChecking = false;
        let completedStages = new Set();
        let startTime = 0;
        let gameTime = 0;
        let timeLimit = 0;
        let timer = null;
        let remainingTime = 0;

        // ã‚¹ã‚¿ãƒŸãƒŠã‚·ã‚¹ãƒ†ãƒ 
        let sunflowerSeeds = 3;
        let lastStaminaUpdate = Date.now();
        let rewardStock = {};

        // ã‚¹ãƒ†ãƒ¼ã‚¸è¨­å®šï¼ˆ6æšã‹ã‚‰24æšã¾ã§ã€2æšãšã¤å¢—åŠ ï¼‰
        const stageConfig = {
            1: { cards: 6, pairs: 3, rounds: 3, timeLimit: 15 },
            2: { cards: 8, pairs: 4, rounds: 3, timeLimit: 15 },
            3: { cards: 10, pairs: 5, rounds: 3, timeLimit: 30 },
            4: { cards: 12, pairs: 6, rounds: 3, timeLimit: 30 },
            5: { cards: 14, pairs: 7, rounds: 3, timeLimit: 45 },
            6: { cards: 16, pairs: 8, rounds: 3, timeLimit: 45 },
            7: { cards: 18, pairs: 9, rounds: 3, timeLimit: 60 },
            8: { cards: 20, pairs: 10, rounds: 3, timeLimit: 60 },
            9: { cards: 22, pairs: 11, rounds: 3, timeLimit: 75 },
            10: { cards: 24, pairs: 12, rounds: 3, timeLimit: 90 }
        };

        // ç”»åƒã‚’èª­ã¿è¾¼ã‚€é–¢æ•°
        async function loadImages() {
            console.log('Loading images...');
            
            // window.fs ãŒåˆ©ç”¨å¯èƒ½ã‹ãƒã‚§ãƒƒã‚¯
            if (typeof window.fs !== 'undefined' && window.fs.readFile) {
                try {
                    // å®Ÿéš›ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸç”»åƒã‚’èª­ã¿è¾¼ã¿
                    const imageNames = [
                        'ã“ã“ãŸ', 'ã“ã²ã‚“', 'ã“ãµã‚Œ', 'ã‚³ãƒ¬ãƒƒãƒˆ', 'ã‚¢ãƒ•ã‚©ã‚¬ãƒ¼ãƒˆ', 
                        'ã‚¢ãƒãƒ¬ãƒƒãƒ†ã‚£', 'ãˆãã‚Œã‚', 'ãŠã¯ã', 'ã‹ãšã¦ã‚‰', 'ã‚¬ãƒŠãƒƒã‚·ãƒ¥',
                        'ã‚«ãƒ•ã‚§ã‚ªãƒ¬', 'ã‚µãƒ«ã‚¿ãƒŠ', 'ã“ã“ã‚'
                    ];
                    
                    // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’è©¦è¡Œ
                    for (let i = 1; i <= 20; i++) {
                        if (i === 9) continue; // Image 9 ã¯è£é¢ãªã®ã§ã‚¹ã‚­ãƒƒãƒ—
                        
                        try {
                            console.log(`Attempting to load Image ${i}`);
                            const imageData = await window.fs.readFile(`Image ${i}: `);
                            const blob = new Blob([imageData]);
                            const imageUrl = URL.createObjectURL(blob);
                            hamsterImages.push(imageUrl);
                            console.log(`Successfully loaded Image ${i}`);
                        } catch (error) {
                            console.log(`Image ${i} not found: ${error.message}`);
                        }
                    }
                    
                    // ã‚«ãƒ¼ãƒ‰è£é¢ï¼ˆImage 9ï¼‰
                    try {
                        console.log('Loading card back image (Image 9)...');
                        const backData = await window.fs.readFile('Image 9: ');
                        const backBlob = new Blob([backData]);
                        cardBackImage = URL.createObjectURL(backBlob);
                        console.log('Card back image loaded successfully');
                    } catch (error) {
                        console.log('Card back image not found: ' + error.message);
                    }
                    
                } catch (error) {
                    console.error('Error in file system access:', error);
                }
            } else {
                console.log('File system access not available');
            }
            
            // ç”»åƒãŒèª­ã¿è¾¼ã‚ãªã„å ´åˆã¯ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’ä½¿ç”¨
            if (hamsterImages.length === 0) {
                console.log('No images loaded, using fallback');
                setImageData();
            }
            
            console.log(`Total images available: ${hamsterImages.length}`);
            initializeGame();
        }

        // ã‚²ãƒ¼ãƒ åˆæœŸåŒ–
        function initializeGame() {
            loadGameData();
            updateStamina();
            createStageSelector();
            startStage(currentStage, currentRound);
            setInterval(updateStamina, 60000); // 1åˆ†ã”ã¨ã«ã‚¹ã‚¿ãƒŸãƒŠæ›´æ–°
        }

        // ã‚²ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
        function loadGameData() {
            const savedData = localStorage.getItem('hamuketsu-game-data');
            if (savedData) {
                const data = JSON.parse(savedData);
                sunflowerSeeds = data.sunflowerSeeds || 3;
                lastStaminaUpdate = data.lastStaminaUpdate || Date.now();
                rewardStock = data.rewardStock || {};
                completedStages = new Set(data.completedStages || []);
                currentStage = data.currentStage || 1;
                currentRound = data.currentRound || 1;
            }
        }

        // ã‚²ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ä¿å­˜
        function saveGameData() {
            const data = {
                sunflowerSeeds: sunflowerSeeds,
                lastStaminaUpdate: lastStaminaUpdate,
                rewardStock: rewardStock,
                completedStages: Array.from(completedStages),
                currentStage: currentStage,
                currentRound: currentRound
            };
            localStorage.setItem('hamuketsu-game-data', JSON.stringify(data));
        }

        // ã‚¹ã‚¿ãƒŸãƒŠæ›´æ–°
        function updateStamina() {
            const now = Date.now();
            const timeDiff = now - lastStaminaUpdate;
            const recoveredSeeds = Math.floor(timeDiff / (30 * 60 * 1000)); // 30åˆ† = 1å€‹å›å¾©
            
            if (recoveredSeeds > 0 && sunflowerSeeds < 3) {
                sunflowerSeeds = Math.min(3, sunflowerSeeds + recoveredSeeds);
                lastStaminaUpdate = now;
                saveGameData();
            }
            
            updateStaminaDisplay();
        }

        // ã‚¹ã‚¿ãƒŸãƒŠè¡¨ç¤ºæ›´æ–°
        function updateStaminaDisplay() {
            document.getElementById('sunflower-count').textContent = sunflowerSeeds;
            
            const timerElement = document.getElementById('stamina-timer');
            const recoveryTimeElement = document.getElementById('recovery-time');
            
            if (sunflowerSeeds < 3) {
                const nextRecoveryTime = lastStaminaUpdate + (30 * 60 * 1000);
                const timeUntilRecovery = Math.max(0, nextRecoveryTime - Date.now());
                const minutes = Math.floor(timeUntilRecovery / 60000);
                const seconds = Math.floor((timeUntilRecovery % 60000) / 1000);
                
                recoveryTimeElement.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                timerElement.style.display = 'block';
            } else {
                timerElement.style.display = 'none';
            }
        }

        // ã‚¹ãƒ†ãƒ¼ã‚¸ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ä½œæˆ
        function createStageSelector() {
            const selector = document.getElementById('stage-selector');
            selector.innerHTML = '';
            
            for (let stage = 1; stage <= 10; stage++) {
                for (let round = 1; round <= 3; round++) {
                    const btn = document.createElement('button');
                    btn.className = 'stage-btn';
                    btn.textContent = `${stage}-${round}`;
                    
                    // ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ­ãƒƒã‚¯åˆ¤å®š
                    const isLocked = !canAccessStage(stage, round);
                    const isCompleted = completedStages.has(`${stage}-${round}`);
                    const isActive = stage === currentStage && round === currentRound;
                    
                    if (isLocked) {
                        btn.classList.add('locked');
                        btn.onclick = () => alert('å‰ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã‚’ã‚¯ãƒªã‚¢ã—ã¦ãã ã•ã„ï¼');
                    } else {
                        btn.onclick = () => startStage(stage, round);
                    }
                    
                    if (isCompleted) {
                        btn.classList.add('completed');
                    }
                    if (isActive) {
                        btn.classList.add('active');
                    }
                    
                    selector.appendChild(btn);
                }
            }
        }

        // ã‚¹ãƒ†ãƒ¼ã‚¸ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½åˆ¤å®š
        function canAccessStage(stage, round) {
            if (stage === 1 && round === 1) return true; // æœ€åˆã®ã‚¹ãƒ†ãƒ¼ã‚¸ã¯å¸¸ã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
            
            // å‰ã®ãƒ©ã‚¦ãƒ³ãƒ‰ãŒã‚¯ãƒªã‚¢æ¸ˆã¿ã‹ç¢ºèª
            if (round > 1) {
                return completedStages.has(`${stage}-${round - 1}`);
            }
            
            // å‰ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã®æœ€çµ‚ãƒ©ã‚¦ãƒ³ãƒ‰ãŒã‚¯ãƒªã‚¢æ¸ˆã¿ã‹ç¢ºèª
            return completedStages.has(`${stage - 1}-3`);
        }

        // ã‚¹ãƒ†ãƒ¼ã‚¸é–‹å§‹
        function startStage(stage, round) {
            if (!canAccessStage(stage, round)) {
                alert('å‰ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã‚’ã‚¯ãƒªã‚¢ã—ã¦ãã ã•ã„ï¼');
                return;
            }
            
            // ã‚¯ãƒªã‚¢æ¸ˆã¿ã‚¹ãƒ†ãƒ¼ã‚¸ã§ãªã„å ´åˆã€ã²ã¾ç¨®ãƒã‚§ãƒƒã‚¯
            const isCleared = completedStages.has(`${stage}-${round}`);
            if (!isCleared && sunflowerSeeds <= 0) {
                alert('ğŸŒ» ã²ã¾ç¨®ãŒè¶³ã‚Šã¾ã›ã‚“ï¼æ™‚é–“ã‚’ãŠã„ã¦å†æŒ‘æˆ¦ã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            
            currentStage = stage;
            currentRound = round;
            matchedPairs = 0;
            attempts = 0;
            flippedCards = [];
            isChecking = false;
            startTime = Date.now();
            gameTime = 0;
            timeLimit = stageConfig[stage].timeLimit;
            remainingTime = timeLimit;
            
            // ã‚¯ãƒªã‚¢æ¸ˆã¿ã§ãªã„å ´åˆã®ã¿ã²ã¾ç¨®æ¶ˆè²»
            if (!isCleared) {
                sunflowerSeeds--;
                saveGameData();
                updateStaminaDisplay();
            }

            updateUI();
            createGameBoard();
            createStageSelector();
            startTimer();
        }

        // ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹
        function startTimer() {
            clearInterval(timer);
            const timerDisplay = document.getElementById('time-remaining');
            const timerElement = document.querySelector('.timer-display');
            
            timer = setInterval(() => {
                remainingTime = Math.max(0, timeLimit - Math.floor((Date.now() - startTime) / 1000));
                timerDisplay.textContent = remainingTime;
                
                if (remainingTime <= 5) {
                    timerElement.classList.add('timer-warning');
                } else {
                    timerElement.classList.remove('timer-warning');
                }
                
                if (remainingTime <= 0) {
                    clearInterval(timer);
                    gameOver();
                }
            }, 1000);
            
            timerDisplay.textContent = remainingTime;
        }

        // ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼
        function gameOver() {
            isChecking = true; // ã‚«ãƒ¼ãƒ‰ã‚¯ãƒªãƒƒã‚¯ç„¡åŠ¹
            document.getElementById('remaining-seeds').textContent = sunflowerSeeds;
            
            const retryBtn = document.getElementById('retry-btn');
            if (sunflowerSeeds <= 0) {
                retryBtn.disabled = true;
                retryBtn.textContent = 'ã²ã¾ç¨®ä¸è¶³';
            } else {
                retryBtn.disabled = false;
                retryBtn.textContent = 'ã²ã¾ç¨®ã§å†æŒ‘æˆ¦';
            }
            
            document.getElementById('game-over').style.display = 'flex';
        }

        // ã²ã¾ç¨®ã§å†æŒ‘æˆ¦
        function retryWithSeed() {
            if (sunflowerSeeds <= 0) {
                alert('ã²ã¾ç¨®ãŒè¶³ã‚Šã¾ã›ã‚“ï¼');
                return;
            }
            
            document.getElementById('game-over').style.display = 'none';
            startStage(currentStage, currentRound);
        }

        // ã‚¹ãƒ†ãƒ¼ã‚¸ã‚’è«¦ã‚ã‚‹
        function giveUpStage() {
            document.getElementById('game-over').style.display = 'none';
            // æœ€åˆã®ã‚¹ãƒ†ãƒ¼ã‚¸ã«æˆ»ã‚‹
            startStage(1, 1);
        }

        // ã‚²ãƒ¼ãƒ ãƒœãƒ¼ãƒ‰ä½œæˆ
        function createGameBoard() {
            const board = document.getElementById('game-board');
            board.innerHTML = '';
            
            const config = stageConfig[currentStage];
            const cardCount = config.cards;
            const pairCount = config.pairs;
            
            // ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ã‚°ãƒªãƒƒãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆè¨­å®š
            if (cardCount <= 8) {
                board.style.gridTemplateColumns = `repeat(${cardCount/2}, 1fr)`;
                board.style.maxWidth = `${cardCount/2 * 130}px`;
            } else if (cardCount <= 12) {
                board.style.gridTemplateColumns = 'repeat(6, 1fr)';
                board.style.maxWidth = '780px';
            } else if (cardCount <= 16) {
                board.style.gridTemplateColumns = 'repeat(8, 1fr)';
                board.style.maxWidth = '1040px';
            } else if (cardCount <= 20) {
                board.style.gridTemplateColumns = 'repeat(10, 1fr)';
                board.style.maxWidth = '1300px';
            } else {
                board.style.gridTemplateColumns = 'repeat(12, 1fr)';
                board.style.maxWidth = '1560px';
            }

            // ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ: ç”»é¢å¹…ãŒç‹­ã„å ´åˆã¯åˆ—æ•°ã‚’èª¿æ•´
            const screenWidth = window.innerWidth;
            if (screenWidth <= 480) {
                if (cardCount <= 6) {
                    board.style.gridTemplateColumns = 'repeat(3, 1fr)';
                } else if (cardCount <= 12) {
                    board.style.gridTemplateColumns = 'repeat(4, 1fr)';
                } else if (cardCount <= 20) {
                    board.style.gridTemplateColumns = 'repeat(5, 1fr)';
                } else {
                    board.style.gridTemplateColumns = 'repeat(6, 1fr)';
                }
                board.style.maxWidth = '360px';
            } else if (screenWidth <= 768) {
                if (cardCount <= 8) {
                    board.style.gridTemplateColumns = 'repeat(4, 1fr)';
                } else if (cardCount <= 16) {
                    board.style.gridTemplateColumns = 'repeat(6, 1fr)';
                } else {
                    board.style.gridTemplateColumns = 'repeat(8, 1fr)';
                }
                board.style.maxWidth = '600px';
            }

            // ã‚«ãƒ¼ãƒ‰ãƒšã‚¢ã‚’ä½œæˆ
            const cardPairs = [];
            for (let i = 0; i < pairCount; i++) {
                const imageIndex = i % hamsterImages.length;
                cardPairs.push(imageIndex, imageIndex);
            }

            // ã‚·ãƒ£ãƒƒãƒ•ãƒ«
            shuffleArray(cardPairs);

            // ã‚«ãƒ¼ãƒ‰è¦ç´ ã‚’ä½œæˆ
            cardPairs.forEach((imageIndex, index) => {
                const card = createCard(imageIndex, index);
                board.appendChild(card);
            });
        }

        // ã‚«ãƒ¼ãƒ‰è¦ç´ ä½œæˆ
        function createCard(imageIndex, cardIndex) {
            const card = document.createElement('div');
            card.className = 'card';
            card.dataset.imageIndex = imageIndex;
            card.dataset.cardIndex = cardIndex;
            card.onclick = () => flipCard(card);

            const cardBack = document.createElement('div');
            cardBack.className = 'card-face card-back';
            
            const cardFront = document.createElement('div');
            cardFront.className = 'card-face card-front';

            // è£é¢ç”»åƒ
            if (cardBackImage) {
                const backImg = document.createElement('img');
                backImg.src = cardBackImage;
                backImg.className = 'back-card-image';
                cardBack.appendChild(backImg);
            } else {
                cardBack.textContent = '?';
                cardBack.style.fontSize = '3rem';
                cardBack.style.color = 'white';
            }

            // è¡¨é¢ç”»åƒ
            if (hamsterImages[imageIndex]) {
                const frontImg = document.createElement('img');
                frontImg.src = hamsterImages[imageIndex];
                frontImg.className = 'card-image';
                cardFront.appendChild(frontImg);
            } else {
                cardFront.style.background = `hsl(${imageIndex * 30}, 70%, 60%)`;
                cardFront.textContent = 'ğŸ¹';
                cardFront.style.fontSize = '3rem';
            }

            card.appendChild(cardBack);
            card.appendChild(cardFront);

            return card;
        }

        // ã‚«ãƒ¼ãƒ‰ãƒ•ãƒªãƒƒãƒ—
        function flipCard(card) {
            if (isChecking || card.classList.contains('flipped') || card.classList.contains('matched')) {
                return;
            }

            card.classList.add('flipped');
            flippedCards.push(card);

            if (flippedCards.length === 2) {
                attempts++;
                updateUI();
                checkMatch();
            }
        }

        // ãƒãƒƒãƒç¢ºèª
        function checkMatch() {
            isChecking = true;
            const [card1, card2] = flippedCards;
            
            setTimeout(() => {
                if (card1.dataset.imageIndex === card2.dataset.imageIndex) {
                    // ãƒãƒƒãƒæˆåŠŸ
                    card1.classList.add('matched');
                    card2.classList.add('matched');
                    matchedPairs++;
                    
                    if (matchedPairs === stageConfig[currentStage].pairs) {
                        setTimeout(() => completeStage(), 500);
                    }
                } else {
                    // ãƒãƒƒãƒå¤±æ•—
                    card1.classList.remove('flipped');
                    card2.classList.remove('flipped');
                }
                
                flippedCards = [];
                isChecking = false;
                updateUI();
            }, 1000);
        }

        // ã‚¹ãƒ†ãƒ¼ã‚¸ã‚¯ãƒªã‚¢
        function completeStage() {
            const stageKey = `${currentStage}-${currentRound}`;
            completedStages.add(stageKey);
            gameTime = Math.floor((Date.now() - startTime) / 1000);
            clearInterval(timer);
            
            // èŠ±ç«ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
            createFireworks();
            
            // x-3ã‚¯ãƒªã‚¢æ™‚ã®ã‚¹ã‚¿ãƒŸãƒŠå›å¾©ã¨ãƒœãƒ¼ãƒŠã‚¹
            if (currentRound === 3) {
                sunflowerSeeds = Math.min(sunflowerSeeds + 3, 3); // æœ€å¤§3å€‹ã¾ã§
                lastStaminaUpdate = Date.now();
            }
            
            // å ±é…¬ã¯æœ€çµ‚ãƒ©ã‚¦ãƒ³ãƒ‰ï¼ˆx-3ï¼‰ã®ã¿è¡¨ç¤º
            const showReward = currentRound === 3;
            let rewardImage = '';
            let rewardName = '';
            
            if (showReward && rewardImages.length > 0) {
                // å ±é…¬ç”»åƒã‚’ä½¿ç”¨ï¼ˆã‚¹ãƒ†ãƒ¼ã‚¸ã«å¯¾å¿œï¼‰
                const rewardIndex = (currentStage - 1) % rewardImages.length;
                rewardImage = rewardImages[rewardIndex];
                rewardName = getRewardName(currentStage);
                
                // å ±é…¬ã‚’ã‚¹ãƒˆãƒƒã‚¯ã«è¿½åŠ 
                if (!rewardStock[rewardName]) {
                    rewardStock[rewardName] = 0;
                }
                rewardStock[rewardName]++;
            }
            
            // ãƒ‡ãƒ¼ã‚¿ä¿å­˜
            saveGameData();
            updateStaminaDisplay();
            
            // ã‚¯ãƒªã‚¢ç”»é¢è¡¨ç¤º
            document.getElementById('completed-stage').textContent = stageKey;
            document.getElementById('clear-time').textContent = gameTime;
            
            if (showReward) {
                document.getElementById('reward-section').style.display = 'block';
                document.getElementById('reward-image').src = rewardImage;
                document.getElementById('reward-name').textContent = rewardName;
            } else {
                document.getElementById('reward-section').style.display = 'none';
            }
            
            document.getElementById('stage-complete').style.display = 'flex';
        }

        // å ±é…¬åå–å¾—
        function getRewardName(stage) {
            const rewards = [
                'ã²ã¾ã‚ã‚Šã®ç¨®', 'ã«ã‚“ã˜ã‚“ã‚¹ãƒ†ã‚£ãƒƒã‚¯', 'ãƒãƒ ã‚·ãƒ¼ãƒ‰', 
                'ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒšãƒ¬ãƒƒãƒˆ', 'ç‰¹è£½ãŠã‚„ã¤', 'ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ãƒŠãƒƒãƒ„',
                'ãƒ¬ã‚¸ã‚§ãƒ³ãƒ‰ã‚­ãƒ£ãƒ­ãƒƒãƒˆ', 'ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰ã‚·ãƒ¼ãƒ‰', 'ãƒ¬ã‚¢å›ã—è»Š', 'ãƒŸãƒ©ã‚¯ãƒ«ãƒãƒ¼ã‚º'
            ];
            return rewards[stage - 1] || 'ãƒŸã‚¹ãƒ†ãƒªãƒ¼å ±é…¬';
        }

        // èŠ±ç«ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
        function createFireworks() {
            const fireworks = document.getElementById('fireworks');
            
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const firework = document.createElement('div');
                    firework.className = 'firework';
                    firework.style.left = Math.random() * 100 + '%';
                    firework.style.top = Math.random() * 100 + '%';
                    firework.style.background = `hsl(${Math.random() * 360}, 70%, 60%)`;
                    fireworks.appendChild(firework);
                    
                    setTimeout(() => firework.remove(), 1000);
                }, i * 100);
            }
        }

        // æ¬¡ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã¸
        function nextStage() {
            document.getElementById('stage-complete').style.display = 'none';
            
            if (currentRound < 3) {
                startStage(currentStage, currentRound + 1);
            } else if (currentStage < 10) {
                startStage(currentStage + 1, 1);
            } else {
                // å…¨ã‚¹ãƒ†ãƒ¼ã‚¸ã‚¯ãƒªã‚¢
                alert('ğŸ‰ å…¨ã‚¹ãƒ†ãƒ¼ã‚¸ã‚¯ãƒªã‚¢ï¼ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼ ğŸ‰');
            }
        }

        // SNSã‚·ã‚§ã‚¢æ©Ÿèƒ½
        function shareToTwitter() {
            const showReward = currentRound === 3;
            let text;
            
            if (showReward) {
                const rewardName = getRewardName(currentStage);
                text = `${currentStage}ã‚¹ãƒ†ãƒ¼ã‚¸ ${gameTime}ç§’ã§ã‚¯ãƒªã‚¢âœ¨å ±é…¬${rewardName}ã‚’ã‚²ãƒƒãƒˆğŸ¹ #ãƒãƒ ã‚±ãƒ„ç¥çµŒè¡°å¼± #ãƒãƒ ã‚¹ã‚¿ãƒ¼ #ã¯ã‚€ãƒãƒ©`;
            } else {
                text = `${currentStage}-${currentRound} ${gameTime}ç§’ã§ã‚¯ãƒªã‚¢âœ¨ #ãƒãƒ ã‚±ãƒ„ç¥çµŒè¡°å¼± #ãƒãƒ ã‚¹ã‚¿ãƒ¼ #ã¯ã‚€ãƒãƒ©`;
            }
            
            const url = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}`;
            window.open(url, '_blank');
        }

        function shareToLine() {
            const showReward = currentRound === 3;
            let text;
            
            if (showReward) {
                const rewardName = getRewardName(currentStage);
                text = `${currentStage}ã‚¹ãƒ†ãƒ¼ã‚¸ ${gameTime}ç§’ã§ã‚¯ãƒªã‚¢âœ¨å ±é…¬${rewardName}ã‚’ã‚²ãƒƒãƒˆğŸ¹`;
            } else {
                text = `${currentStage}-${currentRound} ${gameTime}ç§’ã§ã‚¯ãƒªã‚¢âœ¨`;
            }
            
            const url = `https://social-plugins.line.me/lineit/share?url=${encodeURIComponent(window.location.href)}&text=${encodeURIComponent(text)}`;
            window.open(url, '_blank');
        }

        // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function shuffleCards() {
            createGameBoard();
        }

        function resetGame() {
            startStage(1, 1);
            completedStages.clear();
        }

        function updateUI() {
            document.getElementById('current-stage').textContent = `${currentStage}-${currentRound}`;
            document.getElementById('card-count').textContent = stageConfig[currentStage].cards;
            document.getElementById('pairs-found').textContent = matchedPairs;
            document.getElementById('total-pairs').textContent = stageConfig[currentStage].pairs;
            document.getElementById('attempts').textContent = attempts;
        }

        // å®Ÿéš›ã®ç”»åƒãƒ‡ãƒ¼ã‚¿ã‚’è¨­å®šã™ã‚‹é–¢æ•°ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”¨ï¼‰
        function setImageData() {
            console.log('Using fallback hamster images');
            // ãƒãƒ ã‚¹ã‚¿ãƒ¼çµµæ–‡å­—ã‚’ä½¿ã£ãŸå¤šæ§˜ãªãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼
            const hamsterEmojis = ['ğŸ¹', 'ğŸ­', 'ğŸ°', 'ğŸ¦”', 'ğŸ¿ï¸'];
            const colors = ['#FFB6C1', '#98FB98', '#87CEEB', '#DDA0DD', '#F0E68C', '#FFA07A', '#20B2AA', '#87CEFA', '#F5DEB3'];
            
            for (let i = 0; i < 19; i++) {
                const emoji = hamsterEmojis[i % hamsterEmojis.length];
                const color = colors[i % colors.length];
                hamsterImages.push(`data:image/svg+xml,${encodeURIComponent(`
                    <svg width="200" height="250" xmlns="http://www.w3.org/2000/svg">
                        <rect width="200" height="250" fill="${color}" rx="15"/>
                        <text x="100" y="100" text-anchor="middle" font-size="60">${emoji}</text>
                        <text x="100" y="140" text-anchor="middle" font-size="16" fill="#333">ãƒãƒ ã‚¹ã‚¿ãƒ¼</text>
                        <text x="100" y="160" text-anchor="middle" font-size="16" fill="#333">${i + 1}</text>
                    </svg>
                `)}`);
            }
            
            // ã‚«ãƒ¼ãƒ‰è£é¢
            if (!cardBackImage) {
                cardBackImage = `data:image/svg+xml,${encodeURIComponent(`
                    <svg width="200" height="250" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <linearGradient id="backGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#667eea;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#764ba2;stop-opacity:1" />
                            </linearGradient>
                        </defs>
                        <rect width="200" height="250" fill="url(#backGrad)" rx="15"/>
                        <text x="100" y="125" text-anchor="middle" font-size="80" fill="white">?</text>
                        <circle cx="50" cy="50" r="10" fill="rgba(255,255,255,0.3)"/>
                        <circle cx="150" cy="80" r="8" fill="rgba(255,255,255,0.2)"/>
                        <circle cx="170" cy="200" r="12" fill="rgba(255,255,255,0.2)"/>
                        <circle cx="30" cy="180" r="6" fill="rgba(255,255,255,0.3)"/>
                    </svg>
                `)}`;
            }
            
            console.log(`Generated ${hamsterImages.length} fallback images`);
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // å®Ÿéš›ã®ç”»åƒã‚’èª­ã¿è¾¼ã‚€
            loadImages();
            
            // 1åˆ†ã”ã¨ã«ã‚¹ã‚¿ãƒŸãƒŠè¡¨ç¤ºæ›´æ–°
            setInterval(updateStaminaDisplay, 1000);
        });
    </script>
</body>
</html>